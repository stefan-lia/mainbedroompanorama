var isMadeByIVisit360;var dsrAsst;var nvgMd=1;var ptsPlnCrs=false,crtCpt,isCptVsb=false,vgntVsb=false,indPlCrt,vrsChg=false;var tbImgVidHTML=new Array();var camera,scene,rdr2D,rdr3D,cnv2D,cnv3D,ctx2d;var txt_plchld,isUsrIntrtg=false,isUsrMvg=false,onMseDnMseX=0,onMseDnMseY=0,lon=0,onMseDnLn=0,lat=0,onMseDnLt=0,phi=0,theta=0;var oldtheta=0,theta2=0;var mousex=0,mousey=0;var oldTouchDist;var deviceAlpha,deviceBeta,deviceGamma;var deviceGX,deviceGY,deviceGZ;var isUsingMotion=false;var deviceOrientationData=null;var currentScreenOrientation=window.orientation||0;var INTERSECTED;var projector;var geometrySphere=new THREE.SphereGeometry(4,8,6,true);var materialSphere=new THREE.MeshBasicMaterial({color:16711680,wireframe:false});var mtrlPno,materials;var mesh;var iTVers1=-1,iTVers2=-1,cTVers2=0;var isOverControls=false;var ind1ImgVid=0,ind2ImgVid=0;var materialsTextureImg=new Array();var materialsImg=new Array();var autoRot=false,playOff=false,muteOff=false;init();animate();function overControls(){isOverControls=true}function outControls(){isOverControls=false}function actvtGyr(){isUsingMotion=!isUsingMotion;if(isUsingMotion){document.getElementById("boutonGyro").src="./webglPlayer/gyro_enableOn.png";document.getElementById("boutonGyro").title="Disable gyroscope"}else{document.getElementById("boutonGyro").src="./webglPlayer/gyro_enableOff.png";document.getElementById("boutonGyro").title="Enable gyroscope"}}function autoRotate(){autoRot=!autoRot;if(autoRot){document.getElementById("buttonAutorotate").src="./webglPlayer/autoRotOff.png";document.getElementById("buttonAutorotate").title="Disable autorotation"}else{document.getElementById("buttonAutorotate").src="./webglPlayer/autoRotOn.png";document.getElementById("buttonAutorotate").title="Enable autorotation"}}function playPauseVid(){var a=document.getElementById("fenetreAnnot");if(a.style.visibility=="hidden"&&isCptVsb==false){playOff=!playOff;if(playOff){document.getElementById("buttonPlay").src="./webglPlayer/playOn.png";document.getElementById("buttonPlay").title="Play videos"}else{document.getElementById("buttonPlay").src="./webglPlayer/playOff.png";document.getElementById("buttonPlay").title="Pause videos"}pseVid(playOff)}}function pseVid(c){for(var b=0;b<tbImgVidHTML.length;b++){for(var a=scene.children.length-1;a>=0;a--){if(scene.children[a].name==(tbImgVidHTML[b][0]).name){if(tbImgVidHTML[b][3]==0){if(c){tbImgVidHTML[b][4].pause()}else{tbImgVidHTML[b][4].play()}}}}}}function muteVid(){var a=document.getElementById("fenetreAnnot");if(a.style.visibility=="hidden"&&isCptVsb==false){muteOff=!muteOff;if(muteOff){document.getElementById("buttonMute").src="./webglPlayer/muteOn.png";document.getElementById("buttonMute").title="Sound"}else{document.getElementById("buttonMute").src="./webglPlayer/muteOff.png";document.getElementById("buttonMute").title="Mute"}mtVid(muteOff)}}function mtVid(c){for(var b=0;b<tbImgVidHTML.length;b++){for(var a=scene.children.length-1;a>=0;a--){if(scene.children[a].name==(tbImgVidHTML[b][0]).name){if(tbImgVidHTML[b][3]==0){tbImgVidHTML[b][4].muted=c}}}}}var coordx2,coordy2,coordz2;function vctrRtAnArAx(e,c,b,a,g,f,d){var k=Array();k[0]=c*c+(1-c*c)*Math.cos(e);k[1]=c*b*(1-Math.cos(e))+a*Math.sin(e);k[2]=c*a*(1-Math.cos(e))-b*Math.sin(e);k[3]=c*b*(1-Math.cos(e))-a*Math.sin(e);k[4]=b*b+(1-b*b)*Math.cos(e);k[5]=b*a*(1-Math.cos(e))+c*Math.sin(e);k[6]=c*a*(1-Math.cos(e))+b*Math.sin(e);k[7]=b*a*(1-Math.cos(e))-c*Math.sin(e);k[8]=a*a+(1-a*a)*Math.cos(e);var j=g,i=f,h=d;coordx2=k[0]*j+k[3]*i+k[6]*h;coordy2=k[1]*j+k[4]*i+k[7]*h;coordz2=k[2]*j+k[5]*i+k[8]*h}function crrPtsClq(){if(isMadeByIVisit360==true){var p,n,m,d,o,x;var g;for(var t=0;t<tbTR.length;t++){if(tbTR[t][0]==idCrt){p=tbTR[t][2];n=tbTR[t][3];m=tbTR[t][4];d=p*Math.cos(-aglHCrt*Math.PI/180)+m*Math.sin(-aglHCrt*Math.PI/180);o=n;x=-p*Math.sin(-aglHCrt*Math.PI/180)+m*Math.cos(-aglHCrt*Math.PI/180);var y=1,w=0,v=0,e=1,s=0,a=0;y=Math.cos(-aglHCrt*Math.PI/180);w=0;v=-Math.sin(-aglHCrt*Math.PI/180);vctrRtAnArAx(aglVCrt*Math.PI/180,y,w,v,d,o,x);g=camera.position.clone();var c=new THREE.Vector3(-coordz2,coordy2,coordx2);var b=g.clone().subSelf(c);var u=new THREE.Ray(c,b.clone().normalize());var f=u.intersectObject(mesh);var l;if(f.length>0){var h=new THREE.Mesh(geometrySphere,materialSphere);h.position.x=f[0].point.x;h.position.y=f[0].point.y;h.position.z=f[0].point.z;l=new THREE.Vector3(h.position.x,h.position.y,h.position.z).normalize();h.position.x=h.position.x-10*l.x;h.position.y=h.position.y-10*l.y;h.position.z=h.position.z-10*l.z;h.name=tbTR[t][1];h.visible=false;scene.add(h)}}}}else{var p,n,m;var g;for(var t=0;t<tbTR.length;t++){if(tbTR[t][0]==idCrt){for(var r=1;r<tbTR[t].length;r++){for(var q=0;q<tbCP.length;q+=nbElmPrNd){if(tbCP[q]==tbTR[t][r]){p=tbCP[q+1]*1000;n=tbCP[q+2]*1000;m=tbCP[q+3]*1000;g=camera.position.clone();var c=new THREE.Vector3(-(p-cdxCrt*1000),m-cdzCrt*1000,n-cdyCrt*1000);var b=g.clone().subSelf(c);var u=new THREE.Ray(c,b.clone().normalize());var f=u.intersectObject(mesh);var l;if(f.length>0){var h=new THREE.Mesh(geometrySphere,materialSphere);h.position.x=f[0].point.x;h.position.y=f[0].point.y;h.position.z=f[0].point.z;l=new THREE.Vector3(h.position.x,h.position.y,h.position.z).normalize();tbCP[q+4]=h.position.x=h.position.x-10*l.x;tbCP[q+5]=h.position.y=h.position.y-10*l.y;tbCP[q+6]=h.position.z=h.position.z-10*l.z;h.name=tbCP[q+7];h.visible=false;scene.add(h)}}}}}}}}function efrPtsClq(){if(isMadeByIVisit360==true){ctx2d.clearRect(0,0,window.innerWidth,window.innerHeight);for(var b=0;b<tbTR.length;b++){if(tbTR[b][0]==idCrt){for(var a=scene.children.length-1;a>=0;a--){var c=scene.children[a];if(scene.children[a].name==tbTR[b][1]){scene.remove(c)}}}}}else{ctx2d.clearRect(0,0,window.innerWidth,window.innerHeight);for(var b=0;b<tbCP.length;b+=nbElmPrNd){if(tbCP[b]!=idCrt){for(var a=0;a<scene.children.length;a++){var c=scene.children[a];if(c.position.x==tbCP[b+4]&&c.position.y==tbCP[b+5]&&c.position.z==tbCP[b+6]){scene.remove(c)}}}}}}function crrPtsAnt(){var n,l,k,d,m,t;var g;for(var p=0;p<tbAnt.length;p++){if(tbAnt[p][0]==idCrt&&(tbAnt[p][2]).indexOf("annotationImageVideo")==-1){n=tbAnt[p][4];l=tbAnt[p][5];k=tbAnt[p][6];d=n*Math.cos(-aglHCrt*Math.PI/180)+k*Math.sin(-aglHCrt*Math.PI/180);m=l;t=-n*Math.sin(-aglHCrt*Math.PI/180)+k*Math.cos(-aglHCrt*Math.PI/180);var u=1,s=0,r=0,e=1,o=0,a=0;u=Math.cos(-aglHCrt*Math.PI/180);s=0;r=-Math.sin(-aglHCrt*Math.PI/180);vctrRtAnArAx(aglVCrt*Math.PI/180,u,s,r,d,m,t);g=camera.position.clone();var c=new THREE.Vector3(-coordz2,coordy2,coordx2);var b=g.clone().subSelf(c);var q=new THREE.Ray(c,b.clone().normalize());var f=q.intersectObject(mesh);var j;if(f.length>0){var h=new THREE.Mesh(geometrySphere,materialSphere);h.position.x=f[0].point.x;h.position.y=f[0].point.y;h.position.z=f[0].point.z;j=new THREE.Vector3(h.position.x,h.position.y,h.position.z).normalize();h.position.x=h.position.x-10*j.x;h.position.y=h.position.y-10*j.y;h.position.z=h.position.z-10*j.z;if(tbAnt[p][1]=="onlineWebsite"){h.name="annotLink_onlineWebsite_"+tbAnt[p][2]}else{if(tbAnt[p][1]=="customAnnot"){h.name="annotLink_customAnnot_"+tbAnt[p][2]}else{if(tbAnt[p][1]=="captionAnnot"){if(tbAnt[p][7]==1){h.name="annotLink_captionAnnot1_"+tbAnt[p][2]}else{if(tbAnt[p][7]==0){h.name="annotLink_captionAnnot0_"+tbAnt[p][2]}}}}}h.visible=false;scene.add(h)}}}}function efrPtsAnt(){ctx2d.clearRect(0,0,window.innerWidth,window.innerHeight);for(var c=0;c<tbAnt.length;c++){if(tbAnt[c][0]==idCrt){for(var b=scene.children.length-1;b>=0;b--){var d=scene.children[b];var a=scene.children[b].name;if(a.indexOf("annotLink_")==0){scene.remove(d)}}}}}function affAnt(b){if(isOverControls==false){ccrCptAnt();if(document.getElementById("conteneurVignettes").style.visibility=="visible"){document.getElementById("conteneurVignettes").style.visibility="hidden";document.getElementById("vignettes").style.visibility="hidden";mvThbs(-1)}if(tbAnt[b][1]=="customAnnot"){pseVid(true);isCptVsb=true;var c=document.getElementById("annotPage");c.src=dsrAnt+tbAnt[b][3];var a=document.getElementById("fenetreAnnot");a.style.visibility="visible";document.getElementById("closeAnnot").style.visibility="visible";document.getElementById("closeAnnot").style.top=(window.innerHeight/2-document.getElementById("fenetreAnnot").offsetHeight/2-20)+"px";document.getElementById("closeAnnot").style.left=(window.innerWidth/2+document.getElementById("fenetreAnnot").offsetWidth/2-12)+"px"}else{if(tbAnt[b][1]=="onlineWebsite"){ccrAnt();window.open(tbAnt[b][3])}}}}function ccrAllAnt(){pseVid(playOff);if(document.getElementById("fenetreAnnot").style.visibility=="visible"){ccrAnt()}else{if(document.getElementById("figureAnnot").style.visibility=="visible"){ccrCptAnt()}}document.getElementById("closeAnnot").style.visibility="hidden"}function ccrAnt(){isCptVsb=false;var b=document.getElementById("annotPage");b.src="./webglPlayer/emptyPage.html";var a=document.getElementById("fenetreAnnot");a.style.visibility="hidden"}function affCptAnt(b){if(isOverControls==false){ccrAllAnt();pseVid(true);if(document.getElementById("conteneurVignettes").style.visibility=="visible"){document.getElementById("conteneurVignettes").style.visibility="hidden";document.getElementById("vignettes").style.visibility="hidden";mvThbs(-1)}isCptVsb=true;crtCpt=b;var c=document.getElementById("figureAnnot");if(tbAnt[b][7]==1){var d=document.createElement("img");d.id=tbAnt[b][2];d.src=dsrAnt+tbAnt[b][3];d.alt=tbAnt[b][3];d.width=tbAnt[b][9];d.height=tbAnt[b][10]+10;d.style.display="block";d.style.margin="0 auto"}else{if(tbAnt[b][7]==0){var d=document.createElement("video");d.id=tbAnt[b][2];d.src=dsrAnt+tbAnt[b][3];d.style.display="block";d.style.margin="0 auto";d.loop=true;d.autoplay=true;d.width=tbAnt[b][9];d.height=tbAnt[b][10]+10;d.play()}}var a=document.createElement("figcaption");a.id="caption__"+tbAnt[b][2];a.style.overflow="auto";a.style.backgroundColor="rgba(255,255,255, 1)";a.style.border="2px solid rgba(255,255,255,1)";a.innerHTML=tbAnt[b][8];c.appendChild(d);if(tbAnt[b][8]!=""){c.appendChild(a)}document.getElementById(tbAnt[b][2]).style.border="2px solid rgba(255,255,255,1)";document.getElementById(tbAnt[b][2]).style.backgroundColor="rgba(255,255,255, 1)";if(tbAnt[b][7]==0){document.getElementById(tbAnt[b][2]).onplay=function(){c.style.visibility="visible";rszCpt()}}else{c.style.visibility="visible";rszCpt()}document.getElementById("closeAnnot").style.visibility="visible"}}function rszCpt(){var d=document.getElementById(tbAnt[crtCpt][2]);var f,b;var k=17*3+10;f=tbAnt[crtCpt][9];b=tbAnt[crtCpt][10]+10;var g=window.innerWidth*60/100;var h=(window.innerHeight-k)*70/100;var e=Math.min(g/f,h/b);f=f*e;b=b*e;if(f>20&&b>20){d.width=f;d.height=b}var j=document.getElementById("figureAnnot");var c=(window.innerHeight/2-(b+k)/2-20);var a=(window.innerWidth/2-f/2-40);j.style.top=c+"px";j.style.left=a+"px";var i=document.getElementById("caption__"+tbAnt[crtCpt][2]);if(i){i.style.height=k+"px";i.style.width=f+"px"}document.getElementById("closeAnnot").style.top=(window.innerHeight/2-(b+k)/2-26)+"px";document.getElementById("closeAnnot").style.left=(window.innerWidth/2+f/2)+"px"}function ccrCptAnt(){isCptVsb=false;var a=document.getElementById("figureAnnot");a.innerHTML="";a.style.visibility="hidden"}function initLg(){var b=document.getElementById("logoDiv");var c=document.getElementById("logoImg");c.src=dsrAnt+lgFl;var a=new Image();a.src=dsrAnt+lgFl;a.onload=function(){c.width=this.width;b.height=this.height;b.width=this.width;c.height=this.height;b.style.visibility="visible";setLgPtn()}}function setLgPtn(){var a=document.getElementById("logoDiv");if(lgPst==0){a.style.top="0px";a.style.left="0px"}else{if(lgPst==1){a.style.top="0px";a.style.right="5px"}else{if(lgPst==2){a.style.bottom="20px";a.style.left="0px"}else{if(lgPst==3){a.style.bottom="0px";a.style.right="5px"}}}}}function crrVgnt(){if(isMadeByIVisit360==true){var e=document.getElementById("vignettes");e.style.width=(document.getElementById("conteneurVignettes").offsetWidth-44)+"px";var b=dsrAsst+igFt;var a=document.getElementById("conteneurVignettes");a.style.top=window.innerHeight;for(var d=0;d<tbCP.length;d++){if(tbCP[d][0]==idCrt){document.getElementById("nomVignette").appendChild(document.createTextNode(tbCP[d][0]))}var c=0;if(tbCP[d][4]==false){c=tbCP[d][5]}else{c=tbCP[d][12]}var f=document.createElement("img");f.id=tbCP[d][0];f.src=b+tbCP[d][1]+".jpg";f.title=tbCP[d][0];f.alt="Vignette "+d;f.height=f.width=70;f.align="MIDDLE";f.hspace=f.vspace=10;if(f.id==idCrt){f.style.border="2px solid red"}else{f.style.border="2px solid black"}f.style.cursor="pointer";f.style.display="inline";e.appendChild(f);if(c==1){document.getElementById(f.id).style.display="none"}document.getElementById(f.id).onclick=function(){ccrAllAnt();efrPtsClq();efrPtsAnt();effAntImgVid();for(var h=0;h<tbCP.length;h++){if(tbCP[h][0]==this.id){document.getElementById(idCrt).style.border="2px solid black";var i=idCrt;idCrt=tbCP[h][0];idCrtSmpl=tbCP[h][1];document.getElementById(idCrt).style.border="2px solid red";if(plExt==true&&tbCP[h][4]==true){document.getElementById(nmPlnAffCrt).style.border="2px solid black";document.getElementById(nmPlnCrt).style.border="2px solid black";nmPlnAffCrt=nmPlnCrt=tbCP[h][5];document.getElementById("nomVignettePlan").firstChild.nodeValue=nmPlnCrt}nmIdCrt=tbCP[h][0];aglHCrt=tbCP[h][2];aglVCrt=tbCP[h][3];if(tbCP[h][4]==false){aglFtHCrt=tbCP[h][6];aglFtVCrt=tbCP[h][7];fov=orgFov=tbCP[h][8]}else{aglFtHCrt=tbCP[h][13];aglFtVCrt=tbCP[h][14];fov=orgFov=tbCP[h][15]}for(var g=0;g<materials.length;g++){rdr3D.deallocateTexture(materials[g].map);rdr3D.deallocateTexture(materials[g]);materials[g].deallocate();materials[g].map.deallocate()}materials=[ldTxtr(dsrAsst+igRt+idCrtSmpl+".jpg"),ldTxtr(dsrAsst+igLt+idCrtSmpl+".jpg"),ldTxtr(dsrAsst+igUp+idCrtSmpl+".jpg"),ldTxtr(dsrAsst+igDn+idCrtSmpl+".jpg"),ldTxtr(dsrAsst+igFt+idCrtSmpl+".jpg"),ldTxtr(dsrAsst+igBk+idCrtSmpl+".jpg")];mtrlPno.materials=materials;crrPtsClq();crrPtsAnt();crrAntImgVid();crrAntImgVid2();fndPnVrs(idCrt);pseVid(playOff);mtVid(muteOff);if(vrsChg==false){initCmr()}else{initCmr2()}camera.updateProjectionMatrix();vrsChg=false}}};document.getElementById(f.id).onmouseover=function(){document.getElementById("nomVignette").firstChild.nodeValue=this.title;this.style.border="2px solid blue"};document.getElementById(f.id).onmouseout=function(){document.getElementById("nomVignette").firstChild.nodeValue=nmIdCrt;if(this.id==idCrt){this.style.border="2px solid red"}else{this.style.border="2px solid black"}}}}else{var e=document.getElementById("vignettes");e.style.width=(document.getElementById("conteneurVignettes").offsetWidth-44)+"px";var b=dsrAsst+igFt;for(var d=0;d<tbCP.length;d+=nbElmPrNd){if(tbCP[d]==idCrt){document.getElementById("nomVignette").appendChild(document.createTextNode(tbCP[d+7]))}var f=document.createElement("img");f.id=tbCP[d];f.src=b+tbCP[d]+".jpg";f.title=tbCP[d+7];f.alt="Vignette "+d;f.height=f.width=70;f.align="MIDDLE";f.hspace=f.vspace=10;if(f.id==idCrt){f.style.border="2px solid red"}else{f.style.border="2px solid black"}f.style.cursor="pointer";e.appendChild(f);document.getElementById(f.id).onclick=function(){efrPtsClq();for(var h=0;h<tbCP.length;h+=nbElmPrNd){if(tbCP[h]==this.id){document.getElementById(idCrt).style.border="2px solid black";var i=idCrt;idCrt=tbCP[h];document.getElementById(idCrt).style.border="2px solid red";if(plExt==true&&ptsPlnCrs==true){document.getElementById(nmPlAfCrt).style.border="2px solid black";document.getElementById(nmPlCrt).style.border="2px solid black";if(tbCP[h+8]!="noplanforthisnode"){nmPlAfCrt=nmPlCrt=tbCP[h+8];document.getElementById("nomVignettePlan").firstChild.nodeValue=nmPlCrt.substring(0,nmPlCrt.indexOf(".",0))}}cdxCrt=tbCP[h+1];cdyCrt=tbCP[h+2];cdzCrt=tbCP[h+3];nmIdCrt=tbCP[h+7];anHCrt=tbCP[h+9];anVCrt=tbCP[h+10];anFtHCrt=tbCP[h+11];anFtVCrt=tbCP[h+12];for(var g=0;g<materials.length;g++){rdr3D.deallocateTexture(materials[g].map);rdr3D.deallocateTexture(materials[g]);materials[g].deallocate();materials[g].map.deallocate()}materials=[ldTxtr(dsrAsst+igRt+idCrt+".jpg"),ldTxtr(dsrAsst+igLt+idCrt+".jpg"),ldTxtr(dsrAsst+igUp+idCrt+".jpg"),ldTxtr(dsrAsst+igDn+idCrt+".jpg"),ldTxtr(dsrAsst+igFt+idCrt+".jpg"),ldTxtr(dsrAsst+igBk+idCrt+".jpg")];mtrlPno.materials=materials;crrPtsClq();initCmr();camera.updateProjectionMatrix()}}};document.getElementById(f.id).onmouseover=function(){document.getElementById("nomVignette").firstChild.nodeValue=this.title;this.style.border="2px solid blue"};document.getElementById(f.id).onmouseout=function(){document.getElementById("nomVignette").firstChild.nodeValue=nmIdCrt;if(this.id==idCrt){this.style.border="2px solid red"}else{this.style.border="2px solid black"}}}}}function fndPnVrs(a){iTVers1=-1;iTVers2=-1;cTVers2=0;for(var e=0;e<tbVn.length;e++){if(tbVn[e].indexOf(a)>-1){iTVers1=e;iTVers2=tbVn[e].indexOf(a);cTVers=tbVn[e].length;var f=document.getElementById(idCrt);if(f.style.display=="none"){for(var b=0;b<tbVn[e].length;b++){var d=document.getElementById(tbVn[e][b]);if(d.style.display=="inline"){d.style.display="none";f.style.display="inline";var c=document.getElementById("vignettes");c.replaceChild(f,d);c.appendChild(d);break}}}break}}if(iTVers1==-1){document.getElementById("imgLeftArrowVers").src="./webglPlayer/arrowLeft_disable.png";document.getElementById("imgRightArrowVers").src="./webglPlayer/arrowRight_disable.png";document.getElementById("imgLeftArrowVers").onclick=null;document.getElementById("imgRightArrowVers").onclick=null;document.getElementById("imgLeftArrowVers").ontouchend=null;document.getElementById("imgRightArrowVers").ontouchend=null}else{document.getElementById("imgLeftArrowVers").src="./webglPlayer/arrowLeft.png";document.getElementById("imgRightArrowVers").src="./webglPlayer/arrowRight.png";document.getElementById("imgLeftArrowVers").onclick=chgVrsLft;document.getElementById("imgRightArrowVers").onclick=chgVrsRgt;document.getElementById("imgLeftArrowVers").ontouchend=chgVrsLft;document.getElementById("imgRightArrowVers").ontouchend=chgVrsRgt}document.getElementById("controlButtons").style.left=(window.innerWidth/2-144)+"px"}function chgVrsLft(){if(iTVers1!=-1){if(iTVers2==0){iTVers2=cTVers-1}else{iTVers2--}vrsChg=true;var a=document.getElementById(idCrt);var b=document.getElementById(tbVn[iTVers1][iTVers2]);a.style.display="none";b.style.display="inline";var c=document.getElementById("vignettes");c.replaceChild(b,a);c.appendChild(a);document.getElementById(tbVn[iTVers1][iTVers2]).click();document.getElementById("nomVignette").firstChild.nodeValue=nmIdCrt}}function chgVrsRgt(){if(iTVers1!=-1){if(iTVers2==cTVers-1){iTVers2=0}else{iTVers2++}vrsChg=true;var a=document.getElementById(idCrt);var b=document.getElementById(tbVn[iTVers1][iTVers2]);a.style.display="none";b.style.display="inline";var c=document.getElementById("vignettes");c.replaceChild(b,a);c.appendChild(a);document.getElementById(tbVn[iTVers1][iTVers2]).click();document.getElementById("nomVignette").firstChild.nodeValue=nmIdCrt}}var myInterval=null;function mvThbLftClk(){var a=document.getElementById("vignettes");a.scrollLeft+=-75}function mvThbLft(){myInterval=setInterval(function(){var a=document.getElementById("vignettes");a.scrollLeft+=-75},300)}function mvThbRgtClk(){var a=document.getElementById("vignettes");a.scrollLeft+=75}function mvThbRgt(){myInterval=setInterval(function(){var a=document.getElementById("vignettes");a.scrollLeft+=75},300)}function stpMvThb(){clearInterval(myInterval)}function crrPln(){if(isMadeByIVisit360==true){var k=dsrAsst+"special/";var e=document.getElementById("imgPlanCourant");var b=document.getElementById("vignettesPlan");document.getElementById("nomVignettePlan").appendChild(document.createTextNode(tbPln[0][0]));var g=-1;var n=false;for(var r=0;r<tbPln.length;r++){for(var s=0;s<tbCP.length;s++){if(tbCP[s][4]==true){if(tbCP[s][5]==tbPln[r][0]){ptsPlnCrs=true;if(tbCP[s][0]==idCrt&&n==false){nmPlnCrt=nmPlnAffCrt=tbPln[r][0];document.getElementById("nomVignettePlan").firstChild.nodeValue=nmPlnAffCrt;g=r;e.src=k+tbPln[r][1];n=true}}}}if(ptsPlnCrs==true&&g!=-1){crrPtsPln(tbPln[g][0]);g=-1}else{e.src=k+tbPln[r][1];if(n==false){nmPlnCrt=nmPlnAffCrt=tbPln[r][0];document.getElementById("nomVignettePlan").firstChild.nodeValue=nmPlnAffCrt}}var u=document.createElement("img");u.id=tbPln[r][0];u.src=k+tbPln[r][1];u.alt=tbPln[r][1];u.height=u.width=70;u.align="MIDDLE";u.hspace=u.vspace=10;if(u.id==nmPlnCrt){u.style.border="2px solid red"}else{u.style.border="2px solid black"}u.style.cursor="pointer";b.appendChild(u);document.getElementById(u.id).onclick=function(){vigP=document.getElementById("imgPlanCourant");vigP.src=this.src;for(var i=0;i<tbPln.length;i++){if(tbPln[i][0]==this.id){indPlCrt=i;rszPln(i)}}if(nmPlnAffCrt==nmPlnCrt){document.getElementById(nmPlnAffCrt).style.border="2px solid red"}else{document.getElementById(nmPlnAffCrt).style.border="2px solid black"}nmPlnAffCrt=this.id;if(nmPlnAffCrt==nmPlnCrt){document.getElementById(nmPlnAffCrt).style.border="2px solid red"}else{document.getElementById(nmPlnAffCrt).style.border="2px solid purple"}if(ptsPlnCrs==true){sprPtsPln();crrPtsPln(this.id)}};document.getElementById(u.id).onmouseover=function(){document.getElementById("nomVignettePlan").firstChild.nodeValue=(this.id).substring(0,(this.id).indexOf(".",0));this.style.border="2px solid blue"};document.getElementById(u.id).onmouseout=function(){document.getElementById("nomVignettePlan").firstChild.nodeValue=nmPlnAffCrt.substring(0,nmPlnAffCrt.indexOf(".",0));if(this.id==nmPlnAffCrt){this.style.border="2px solid purple"}else{this.style.border="2px solid black"}if(this.id==nmPlnCrt){this.style.border="2px solid red"}}}if(n==false){nmPlnCrt=nmPlnAffCrt=tbPln[0][0];document.getElementById("nomVignettePlan").firstChild.nodeValue=nmPlnAffCrt}}else{var k=dsrAsst+"special/";var e=document.getElementById("imgPlanCourant");var b=document.getElementById("vignettesPlan");var g=-1;var n=false;for(var r=0;r<tbPln.length;r+=8){for(var s=0;s<tbCP.length;s+=nbElmPrNd){var f=1000000000;var t=tbCP[s];var l=tbCP[s+3];for(var v=0;v<tbPln.length;v+=8){var o=tbCP[s+1];var m=tbCP[s+2];var h=-tbPln[v+7]*Math.PI/180;var q=tbPln[v+1]+(tbPln[v+4]-tbPln[v+1])/2;var p=-(tbPln[v+2]+(tbPln[v+5]-tbPln[v+2])/2);o-=p;m-=q;var d=o*Math.cos(h)-m*Math.sin(h);var c=o*Math.sin(h)+m*Math.cos(h);d+=p;c+=q;o=c;m=-d;var a=(tbPln[v+2]<=tbPln[v+5])?(tbPln[v+2]<=m&&m<=tbPln[v+5]):(tbPln[v+5]<=m&&m<=tbPln[v+2]);a=a&&(tbPln[v+1]<=o&&o<=tbPln[v+4])&&(tbPln[v+6]<=l&&l<=tbPln[v+3])&&(tbPln[v+3]<=f);if(a==true){tbCP[s+8]=tbPln[v];ptsPlnCrs=true;if(tbCP[s]==idCrt&&n==false){document.getElementById("nomVignettePlan").appendChild(document.createTextNode((tbCP[s+8]).substring(0,(tbCP[s+8]).indexOf(".",0))));nmPlCrt=nmPlAfCrt=tbPln[v];g=v;e.src=k+nmPlCrt;n=true}f=tbPln[v+3]}}if(tbCP[s+8]=="noplanforthisnode"){if(tbCP[s]==idCrt&&n==false){nmPlCrt=nmPlAfCrt=tbPln[0];if(!document.getElementById("nomVignettePlan").firstChild){document.getElementById("nomVignettePlan").appendChild(document.createTextNode((tbPln[0]).substring(0,(tbPln[0]).indexOf(".",0))))}g=0;e.src=k+nmPlCrt;n=true}}}if(ptsPlnCrs==true&&g!=-1){crrPtsPln(tbPln[g]);g=-1}else{e.src=k+tbPln[0]}var u=document.createElement("img");u.id=tbPln[r];u.src=k+tbPln[r];u.alt=tbPln[r];u.height=u.width=70;u.align="MIDDLE";u.hspace=u.vspace=10;if(u.id==nmPlCrt){u.style.border="2px solid red"}else{u.style.border="2px solid black"}u.style.cursor="pointer";b.appendChild(u);document.getElementById(u.id).onclick=function(){vigP=document.getElementById("imgPlanCourant");vigP.src=this.src;for(var i=0;i<tbPln.length;i+=8){if(tbPln[i]==this.id){indPlCrt=i;rszPln(i)}}if(nmPlAfCrt==nmPlCrt){document.getElementById(nmPlAfCrt).style.border="2px solid red"}else{document.getElementById(nmPlAfCrt).style.border="2px solid black"}nmPlAfCrt=this.id;if(nmPlAfCrt==nmPlCrt){document.getElementById(nmPlAfCrt).style.border="2px solid red"}else{document.getElementById(nmPlAfCrt).style.border="2px solid purple"}if(ptsPlnCrs==true){sprPtsPln();crrPtsPln(this.id)}};document.getElementById(u.id).onmouseover=function(){document.getElementById("nomVignettePlan").firstChild.nodeValue=(this.id).substring(0,(this.id).indexOf(".",0));this.style.border="2px solid blue"};document.getElementById(u.id).onmouseout=function(){document.getElementById("nomVignettePlan").firstChild.nodeValue=nmPlAfCrt.substring(0,nmPlAfCrt.indexOf(".",0));if(this.id==nmPlAfCrt){this.style.border="2px solid purple"}else{this.style.border="2px solid black"}if(this.id==nmPlCrt){this.style.border="2px solid red"}}}}}function rszPln(q){if(isMadeByIVisit360==true){var k=tbPln[q][2];var f=tbPln[q][3];var n=window.innerWidth*60/100;var o=window.innerHeight*70/100;var j=Math.min(n/k,o/f);k=k*j;f=f*j;var b=document.getElementById("imgPlanCourant");var l=document.getElementById("lePlan");var p=document.getElementById("fenetrePlan");var e=document.getElementById("vignettesPlan");var i=document.getElementById("nomVignettePlan");var h=document.getElementById("leftArrow");var g=document.getElementById("rightArrow");b.style.width=k+"px";b.style.height=f+"px";l.style.width=k+"px";l.style.height=f+"px";p.style.width=window.innerWidth+"px";p.style.height=(f+50)+"px";e.style.overflow="auto";var a=e.offsetHeight;var m=p.offsetHeight;var d=m-a-50;i.style.top=(d+10)+"px";i.style.left=(window.innerWidth/2-l.offsetWidth/2)+"px";l.style.left=(window.innerWidth/2-l.offsetWidth/2)+"px";h.style.marginTop=(d/2-38/2)+"px";h.style.marginLeft="2px";g.style.marginTop=(d/2-38/2)+"px";g.style.marginRight="2px";p.style.top=(window.innerHeight/2-p.offsetHeight/2)+"px";p.style.left=(window.innerWidth/2-p.offsetWidth/2)+"px"}else{var k;var f;var c=new Image();c.src=dsrAsst+"special/"+tbPln[q];c.onload=function(){k=this.width;f=this.height};k=c.width;f=c.height;var n=window.innerWidth*60/100;var o=window.innerHeight*70/100;var j=Math.min(n/k,o/f);k=k*j;f=f*j;var b=document.getElementById("imgPlanCourant");var l=document.getElementById("lePlan");var p=document.getElementById("fenetrePlan");var e=document.getElementById("vignettesPlan");var i=document.getElementById("nomVignettePlan");var h=document.getElementById("leftArrow");var g=document.getElementById("rightArrow");b.style.width=k+"px";b.style.height=f+"px";l.style.width=k+"px";l.style.height=f+"px";p.style.width=(k+6*38)+"px";p.style.height=(f+50)+"px";e.style.overflow="auto";var a=e.offsetHeight;var m=p.offsetHeight;var d=m-a-50;i.style.top=(d+10)+"px";i.style.left=(38*3)+"px";l.style.left=(38*3)+"px";h.style.marginTop=(d/2-38/2)+"px";h.style.marginLeft=(38*2)+"px";g.style.marginTop=(d/2-38/2)+"px";g.style.marginRight=(38*2-10)+"px";p.style.top=window.innerHeight/2-p.offsetHeight/2;p.style.left=window.innerWidth/2-p.offsetWidth/2}}function replacePtsPln(m,b,l,j){var e,a,c,h;var k=b;var d=l;var k=tbPln[indicePlan][2];var d=tbPln[indicePlan][3];for(var g=0;g<tbCP.length;g++){if(tbCP[g][4]==true){if(tbCP[g][12]!=1){if(tbCP[g][5]==nmPlnAffCrt){e=tbCP[g][6];a=tbPln[m][3]-tbCP[g][7];h=(e*100/k-(13*100/k))*j;c=(a*100/d-(13*100/d))*j;var f=document.getElementById("pointMap_"+tbCP[g][0]);f.style.top=c+"%";f.style.left=h+"%"}}}}}function crrPtsPln(n){if(isMadeByIVisit360==true){var t=-1;for(var s=0;s<tbPln.length;s++){if(tbPln[s][0]==n){t=s;break}}var y=document.getElementById("lePlan");var d=y.offsetWidth;var m=y.offsetHeight;var l,u,c,q;var g=tbPln[t][2];var o=tbPln[t][3];var y=document.getElementById("lePlan");for(var s=0;s<tbCP.length;s++){if(tbCP[s][4]==true){if(tbCP[s][12]!=1){if(tbCP[s][5]==n){l=tbCP[s][6];u=o-tbCP[s][7];q=l*100/g-(13*100/g);c=u*100/o-(13*100/o);var j=document.createElement("div");j.id="pointMap_"+tbCP[s][0];j.style.position="absolute";j.style.top=c+"%";j.style.left=q+"%";j.style.color="white";j.style.cursor="pointer";var v=document.createElement("img");v.id="img_pointMap_"+tbCP[s][0];if(tbCP[s][0]==idCrt){v.src="./webglPlayer/pointDuPlan2.png"}else{v.src="./webglPlayer/pointDuPlan.png"}v.title=tbCP[s][0];v.alt=tbCP[s][0];v.height=v.width=26;j.appendChild(v);y.appendChild(j);document.getElementById(j.id).onclick=function(){efrPtsClq();efrPtsAnt();effAntImgVid();for(var C=0;C<tbCP.length;C++){var D=(this.id).substring(9,(this.id).length);if(tbCP[C][0]==D){document.getElementById(idCrt).style.border="2px solid black";var E=idCrt;idCrt=tbCP[C][0];idCrtSmpl=tbCP[C][1];document.getElementById(idCrt).style.border="2px solid red";if(plExt==true&&ptsPlnCrs==true&&tbCP[C][4]==true){document.getElementById(nmPlnCrt).style.border="2px solid black";nmPlnCrt=tbCP[C][5]}nmIdCrt=tbCP[C][0];aglHCrt=tbCP[C][2];aglVCrt=tbCP[C][3];if(tbCP[C][4]==false){aglFtHCrt=tbCP[C][6];aglFtVCrt=tbCP[C][7];fov=orgFov=tbCP[C][8]}else{aglFtHCrt=tbCP[C][13];aglFtVCrt=tbCP[C][14];fov=orgFov=tbCP[C][15]}for(var i=0;i<materials.length;i++){rdr3D.deallocateTexture(materials[i].map);rdr3D.deallocateTexture(materials[i]);materials[i].deallocate();materials[i].map.deallocate()}materials=[ldTxtr(dsrAsst+igRt+idCrtSmpl+".jpg"),ldTxtr(dsrAsst+igLt+idCrtSmpl+".jpg"),ldTxtr(dsrAsst+igUp+idCrtSmpl+".jpg"),ldTxtr(dsrAsst+igDn+idCrtSmpl+".jpg"),ldTxtr(dsrAsst+igFt+idCrtSmpl+".jpg"),ldTxtr(dsrAsst+igBk+idCrtSmpl+".jpg")];mtrlPno.materials=materials;crrPtsClq();crrPtsAnt();crrAntImgVid();crrAntImgVid2();fndPnVrs(idCrt);pseVid(playOff);mtVid(muteOff);initCmr();camera.updateProjectionMatrix()}}affPln()};document.getElementById(j.id).ontouchend=function(){efrPtsClq();efrPtsAnt();effAntImgVid();for(var C=0;C<tbCP.length;C++){var D=(this.id).substring(9,(this.id).length);if(tbCP[C][0]==D){document.getElementById(idCrt).style.border="2px solid black";var E=idCrt;idCrt=tbCP[C][0];idCrtSmpl=tbCP[C][1];document.getElementById(idCrt).style.border="2px solid red";if(plExt==true&&ptsPlnCrs==true&&tbCP[C][4]==true){document.getElementById(nmPlnCrt).style.border="2px solid black";nmPlnCrt=tbCP[C][5]}nmIdCrt=tbCP[C][0];aglHCrt=tbCP[C][2];aglVCrt=tbCP[C][3];if(tbCP[C][4]==false){aglFtHCrt=tbCP[C][6];aglFtVCrt=tbCP[C][7];fov=orgFov=tbCP[C][8]}else{aglFtHCrt=tbCP[C][13];aglFtVCrt=tbCP[C][14];fov=orgFov=tbCP[C][15]}for(var i=0;i<materials.length;i++){rdr3D.deallocateTexture(materials[i].map);rdr3D.deallocateTexture(materials[i]);materials[i].deallocate();materials[i].map.deallocate()}materials=[ldTxtr(dsrAsst+igRt+idCrtSmpl+".jpg"),ldTxtr(dsrAsst+igLt+idCrtSmpl+".jpg"),ldTxtr(dsrAsst+igUp+idCrtSmpl+".jpg"),ldTxtr(dsrAsst+igDn+idCrtSmpl+".jpg"),ldTxtr(dsrAsst+igFt+idCrtSmpl+".jpg"),ldTxtr(dsrAsst+igBk+idCrtSmpl+".jpg")];mtrlPno.materials=materials;crrPtsClq();crrPtsAnt();crrAntImgVid();crrAntImgVid2();fndPnVrs(idCrt);pseVid(playOff);mtVid(muteOff);initCmr();camera.updateProjectionMatrix()}}affPln()}}}}}}else{var t=-1;var A,z,r,p,h,r,p,x,w;for(var s=0;s<tbPln.length;s+=8){if(tbPln[s]==n){t=s;A=tbPln[s+1]-tbPln[s+4];z=tbPln[s+2]-tbPln[s+5];h=-tbPln[s+7]*Math.PI/180;r=tbPln[s+1]+(tbPln[s+4]-tbPln[s+1])/2;p=-(tbPln[s+2]+(tbPln[s+5]-tbPln[s+2])/2);x=tbPln[s+1];w=tbPln[s+2];break}}var y=document.getElementById("lePlan");var d=y.offsetWidth;var m=y.offsetHeight;var l,u,c,q,k,B;var e=Math.min(tbPln[t+1],tbPln[t+4]);var f=(e==tbPln[t+1])?(-tbPln[t+2]):(-tbPln[t+5]);var y=document.getElementById("lePlan");for(var s=0;s<tbCP.length;s+=nbElmPrNd){if(tbCP[s+8]==n){l=tbCP[s+1];u=tbCP[s+2];l-=p;u-=r;var b=l*Math.cos(h)-u*Math.sin(h);var a=l*Math.sin(h)+u*Math.cos(h);b+=p;a+=r;l=a;u=-b;k=Math.abs(l-x)*d/Math.abs(A);B=Math.abs(u-w)*m/Math.abs(z);q=(k-13)*100/d;c=100-(B+13)*100/m;var j=document.createElement("div");j.id="pointMap_"+tbCP[s];j.style.position="absolute";j.style.top=c+"%";j.style.left=q+"%";j.style.color="white";j.style.cursor="pointer";var v=document.createElement("img");v.id="img_pointMap_"+tbCP[s];if(tbCP[s]==idCrt){v.src="./webglPlayer/pointDuPlan2.png"}else{v.src="./webglPlayer/pointDuPlan.png"}v.title=tbCP[s+7];v.alt=tbCP[s+7];v.height=v.width=26;j.appendChild(v);y.appendChild(j);document.getElementById(j.id).onclick=function(){efrPtsClq();for(var C=0;C<tbCP.length;C+=nbElmPrNd){var D=(this.id).substring(9,(this.id).length);if(tbCP[C]==D){document.getElementById(idCrt).style.border="2px solid black";var E=idCrt;idCrt=tbCP[C];document.getElementById(idCrt).style.border="2px solid red";if(plExt==true&&ptsPlnCrs==true){document.getElementById(nmPlCrt).style.border="2px solid black";nmPlCrt=tbCP[C+8]}cdxCrt=tbCP[C+1];cdyCrt=tbCP[C+2];cdzCrt=tbCP[C+3];nmIdCrt=tbCP[C+7];anHCrt=tbCP[C+9];anVCrt=tbCP[C+10];anFtHCrt=tbCP[C+11];anFtVCrt=tbCP[C+12];for(var i=0;i<materials.length;i++){rdr3D.deallocateTexture(materials[i].map);rdr3D.deallocateTexture(materials[i]);materials[i].deallocate();materials[i].map.deallocate()}materials=[ldTxtr(dsrAsst+igRt+idCrt+".jpg"),ldTxtr(dsrAsst+igLt+idCrt+".jpg"),ldTxtr(dsrAsst+igUp+idCrt+".jpg"),ldTxtr(dsrAsst+igDn+idCrt+".jpg"),ldTxtr(dsrAsst+igFt+idCrt+".jpg"),ldTxtr(dsrAsst+igBk+idCrt+".jpg")];mtrlPno.materials=materials;crrPtsClq();initCmr();camera.updateProjectionMatrix()}}affPln()};document.getElementById(j.id).ontouchend=function(){efrPtsClq();for(var C=0;C<tbCP.length;C+=nbElmPrNd){var D=(this.id).substring(9,(this.id).length);if(tbCP[C]==D){document.getElementById(idCrt).style.border="2px solid black";var E=idCrt;idCrt=tbCP[C];document.getElementById(idCrt).style.border="2px solid red";if(plExt==true&&ptsPlnCrs==true){document.getElementById(nmPlCrt).style.border="2px solid black";nmPlCrt=tbCP[C+8]}cdxCrt=tbCP[C+1];cdyCrt=tbCP[C+2];cdzCrt=tbCP[C+3];nmIdCrt=tbCP[C+7];anHCrt=tbCP[C+9];anVCrt=tbCP[C+10];anFtHCrt=tbCP[C+11];anFtVCrt=tbCP[C+12];for(var i=0;i<materials.length;i++){rdr3D.deallocateTexture(materials[i].map);rdr3D.deallocateTexture(materials[i]);materials[i].deallocate();materials[i].map.deallocate()}materials=[ldTxtr(dsrAsst+igRt+idCrt+".jpg"),ldTxtr(dsrAsst+igLt+idCrt+".jpg"),ldTxtr(dsrAsst+igUp+idCrt+".jpg"),ldTxtr(dsrAsst+igDn+idCrt+".jpg"),ldTxtr(dsrAsst+igFt+idCrt+".jpg"),ldTxtr(dsrAsst+igBk+idCrt+".jpg")];mtrlPno.materials=materials;crrPtsClq();initCmr();camera.updateProjectionMatrix()}}affPln()}}}}}function sprPtsPln(){if(isMadeByIVisit360==true){var b=document.getElementById("lePlan");for(var a=0;a<tbCP.length;a++){if(document.getElementById("pointMap_"+tbCP[a][0])){b.removeChild(document.getElementById("pointMap_"+tbCP[a][0]))}}}else{var b=document.getElementById("lePlan");for(var a=0;a<tbCP.length;a+=nbElmPrNd){if(document.getElementById("pointMap_"+tbCP[a])){b.removeChild(document.getElementById("pointMap_"+tbCP[a]))}}}}var planVisible=false;function affPln(){if(isMadeByIVisit360==true){if(plExt==true){var e=document.getElementById("fenetrePlan");if(e.style.visibility=="hidden"){ccrAllAnt();if(document.getElementById(nmPlnCrt)){document.getElementById(nmPlnCrt).click()}document.getElementById("boutonPlan2D").src="./webglPlayer/plan2.png";document.getElementById("boutonPlan2D").title="Hide plan";e.style.visibility="visible";document.getElementById("leftArrow").style.visibility="visible";document.getElementById("rightArrow").style.visibility="visible";if(tbPln.length==1){document.getElementById("leftArrow").style.visibility="hidden";document.getElementById("rightArrow").style.visibility="hidden"}planVisible=true;document.getElementById("conteneurVignettes").style.visibility="hidden";document.getElementById("vignettes").style.visibility="hidden";mvThbs(-1)}else{document.getElementById("boutonPlan2D").src="./webglPlayer/plan.png";document.getElementById("boutonPlan2D").title="Display plan";e.style.visibility="hidden";document.getElementById("leftArrow").style.visibility="hidden";document.getElementById("rightArrow").style.visibility="hidden";document.getElementById("vignettesPlan").style.overflow="hidden";planVisible=false}}}else{if(plExt==true){var e=document.getElementById("fenetrePlan");if(e.style.visibility=="hidden"){if(document.getElementById(nmPlCrt)){document.getElementById(nmPlCrt).click()}document.getElementById("boutonPlan2D").src="./webglPlayer/plan2.png";document.getElementById("boutonPlan2D").title="Hide plan";document.getElementById("vignettesPlan").style.overflow="auto";var b=document.getElementById("vignettesPlan").offsetHeight;var a=document.getElementById("fenetrePlan").offsetHeight;var c=document.getElementById("fenetrePlan").offsetWidth;var d=a-b-50;document.getElementById("lePlan").style.height=d+"px";document.getElementById("nomVignettePlan").style.top=(d+10)+"px";document.getElementById("nomVignettePlan").style.left=(38*3)+"px";document.getElementById("lePlan").style.width=(c-(38*6))+"px";document.getElementById("lePlan").style.left=(38*3)+"px";document.getElementById("leftArrow").style.marginTop=(d/2-38/2)+"px";document.getElementById("leftArrow").style.marginLeft=(38*2)+"px";document.getElementById("rightArrow").style.marginTop=(d/2-38/2)+"px";document.getElementById("rightArrow").style.marginRight=(38*2-10)+"px";e.style.visibility="visible";document.getElementById("leftArrow").style.visibility="visible";document.getElementById("rightArrow").style.visibility="visible";if(tbPln.length==8){document.getElementById("leftArrow").style.visibility="hidden";document.getElementById("rightArrow").style.visibility="hidden"}planVisible=true}else{document.getElementById("boutonPlan2D").src="./webglPlayer/plan.png";document.getElementById("boutonPlan2D").title="Display plan";e.style.visibility="hidden";document.getElementById("leftArrow").style.visibility="hidden";document.getElementById("rightArrow").style.visibility="hidden";document.getElementById("vignettesPlan").style.overflow="hidden";planVisible=false}}}}function prvPln(){if(isMadeByIVisit360==true){for(var b=0;b<tbPln.length;b++){if(tbPln[b][0]==nmPlnAffCrt){var a=b-1;if(a>=0){if(document.getElementById(tbPln[a][0])){document.getElementById(tbPln[a][0]).click();document.getElementById("nomVignettePlan").firstChild.nodeValue=nmPlnAffCrt}break}else{if(document.getElementById(tbPln[tbPln.length-1][0])){document.getElementById(tbPln[tbPln.length-1][0]).click();document.getElementById("nomVignettePlan").firstChild.nodeValue=nmPlnAffCrt}break}}}}else{for(var b=0;b<tbPln.length;b+=8){if(b==0||b%8==0){if(tbPln[b]==nmPlAfCrt){var a=b-8;if(a>=0){if(document.getElementById(tbPln[a])){document.getElementById(tbPln[a]).click();document.getElementById("nomVignettePlan").firstChild.nodeValue=nmPlAfCrt.substring(0,nmPlAfCrt.indexOf(".",0))}break}else{if(document.getElementById(tbPln[tbPln.length-8])){document.getElementById(tbPln[tbPln.length-8]).click();document.getElementById("nomVignettePlan").firstChild.nodeValue=nmPlAfCrt.substring(0,nmPlAfCrt.indexOf(".",0))}break}}}}}}function nxtPln(){if(isMadeByIVisit360==true){for(var b=0;b<tbPln.length;b++){if(tbPln[b][0]==nmPlnAffCrt){var a=b+1;if(a<tbPln.length){if(document.getElementById(tbPln[a][0])){document.getElementById(tbPln[a][0]).click();document.getElementById("nomVignettePlan").firstChild.nodeValue=nmPlnAffCrt}break}else{if(document.getElementById(tbPln[0][0])){document.getElementById(tbPln[0][0]).click();document.getElementById("nomVignettePlan").firstChild.nodeValue=nmPlnAffCrt}break}}}}else{for(var b=0;b<tbPln.length;b+=8){if(b==0||b%8==0){if(tbPln[b]==nmPlAfCrt){var a=b+8;if(a<tbPln.length){if(document.getElementById(tbPln[a])){document.getElementById(tbPln[a]).click();document.getElementById("nomVignettePlan").firstChild.nodeValue=nmPlAfCrt.substring(0,nmPlAfCrt.indexOf(".",0))}break}else{if(document.getElementById(tbPln[0])){document.getElementById(tbPln[0]).click();document.getElementById("nomVignettePlan").firstChild.nodeValue=nmPlAfCrt.substring(0,nmPlAfCrt.indexOf(".",0))}break}}}}}}function init(){if(("isIVisit360" in window)){isMadeByIVisit360=isIVisit360}else{if(igRt=="n_RIGHT_"){isMadeByIVisit360=false}else{if(igRt=="n_RIGHT_NODE_"){isMadeByIVisit360=true}}}dsrAsst="./assets/";if(!Detector.webgl){window.location.replace("./webglPlayer/help.html")}cnv2D=document.getElementById("cnv2D");try{rdr2D=new THREE.CanvasRenderer({canvas:cnv2D});rdr2D.setSize(window.innerWidth,window.innerHeight)}catch(c){window.location.replace("./webglPlayer/help.html")}cnv2D.style.cursor="pointer";if(isMadeByIVisit360==true){document.getElementById("boutonModeNavigation").style.visibility="hidden";document.getElementById("boutonModeNavigation").style.display="none"}else{document.getElementById("imgLeftArrowVers").style.visibility="hidden";document.getElementById("imgRightArrowVers").style.visibility="hidden";document.getElementById("buttonPlay").style.visibility="hidden";document.getElementById("buttonMute").style.visibility="hidden";document.getElementById("imgRightArrowVers").style.visibility="hidden";document.getElementById("imgRightArrowVers").style.visibility="hidden";document.getElementById("imgRightArrowVers").style.visibility="hidden";document.getElementById("imgLeftArrowVers").style.display="none";document.getElementById("imgRightArrowVers").style.display="none";document.getElementById("buttonPlay").style.display="none";document.getElementById("buttonMute").style.display="none";document.getElementById("imgRightArrowVers").style.display="none";document.getElementById("imgRightArrowVers").style.display="none";document.getElementById("imgRightArrowVers").style.display="none"}var a=window.DeviceMotionEvent+" "+window.DeviceOrientationEvent;if(!(a.indexOf("DeviceMotionEventConstructor")>-1&&a.indexOf("DeviceOrientationEventConstructor")>-1)){document.getElementById("boutonGyro").style.visibility="hidden";document.getElementById("boutonGyro").style.display="none";document.getElementById("bouton_Fullscreen").style.marginRight="0px"}if(plExt==false){document.getElementById("boutonPlan2D").src="./webglPlayer/plan_disable.png";document.getElementById("boutonPlan2D").onclick=null;document.getElementById("boutonPlan2D").ontouchend=null}else{document.getElementById("boutonPlan2D").src="./webglPlayer/plan.png";document.getElementById("boutonPlan2D").onclick=affPln;document.getElementById("boutonPlan2D").ontouchend=affPln}cnv3D=document.getElementById("cnv3D");rdr3D=new THREE.WebGLRenderer({canvas:cnv3D,antialias:true});rdr3D.setSize(window.innerWidth,window.innerHeight);ctx2d=rdr2D.domElement.getContext("2d");ctx2d.clearRect(0,0,window.innerWidth,window.innerHeight);if(isMadeByIVisit360==true){ctx2d.font=icnFtT+" "+icnFtS+"px "+icnFtF}else{ctx2d.font="18px 'Times New Roman', Times, serif"}camera=new THREE.PerspectiveCamera(fov,window.innerWidth/window.innerHeight,1,300);camera.target=new THREE.Vector3(0,0,0);scene=new THREE.Scene();txt_plchld=document.createElement("canvas");txt_plchld.width=128;txt_plchld.height=128;var b=txt_plchld.getContext("2d");b.fillStyle="rgb( 200, 200, 200 )";b.fillRect(0,0,txt_plchld.width,txt_plchld.height);if(isMadeByIVisit360==true){materials=[ldTxtr(dsrAsst+igRt+idCrtSmpl+".jpg"),ldTxtr(dsrAsst+igLt+idCrtSmpl+".jpg"),ldTxtr(dsrAsst+igUp+idCrtSmpl+".jpg"),ldTxtr(dsrAsst+igDn+idCrtSmpl+".jpg"),ldTxtr(dsrAsst+igFt+idCrtSmpl+".jpg"),ldTxtr(dsrAsst+igBk+idCrtSmpl+".jpg")]}else{materials=[ldTxtr(dsrAsst+igRt+idCrt+".jpg"),ldTxtr(dsrAsst+igLt+idCrt+".jpg"),ldTxtr(dsrAsst+igUp+idCrt+".jpg"),ldTxtr(dsrAsst+igDn+idCrt+".jpg"),ldTxtr(dsrAsst+igFt+idCrt+".jpg"),ldTxtr(dsrAsst+igBk+idCrt+".jpg")]}mtrlPno=new THREE.MeshFaceMaterial(materials);mtrlPno.needsUpdate=true;mesh=new THREE.Mesh(new THREE.CubeGeometry(256,256,256,7,7,7),mtrlPno);mesh.scale.x=-1;scene.add(mesh);initCmr();projector=new THREE.Projector();if(isMadeByIVisit360==true){if(lgFl!=""){initLg()}if(tbIgVd.length>0){initAntImgVidCrds();crrAntImgVid();crrAntImgVid2()}else{document.getElementById("buttonPlay").onclick=null;document.getElementById("buttonMute").onclick=null;document.getElementById("buttonPlay").src="./webglPlayer/playOn_disable.png";document.getElementById("buttonMute").src="./webglPlayer/muteOff_disable.png"}if(tbTR.length>0){crrPtsClq()}if(tbAnt.length>0){crrPtsAnt()}if(plExt==true){crrPln()}crrVgnt();fndPnVrs(idCrt)}else{if(tbTR.length>0){crrPtsClq()}if(plExt==true){crrPln()}crrVgnt()}if(isMadeByIVisit360==true){document.getElementById("controlButtons").style.left=(window.innerWidth/2-144)+"px"}else{document.getElementById("controlButtons").style.left=(window.innerWidth/2-82)+"px"}document.addEventListener("mousedown",onDctMseDn,false);document.addEventListener("mousemove",onDctMseMv,false);document.addEventListener("mouseup",onDctMseUp,false);document.addEventListener("dblclick",onDblClk,false);document.addEventListener("mousewheel",onDctMsWhl,false);document.addEventListener("DOMMouseScroll",onDctMsWhl,false);window.addEventListener("resize",onWindowResize,false);var d=" "+window.TouchEvent;if(d.indexOf("TouchEventConstructor")>-1){document.addEventListener("touchstart",onDctTchStart,false);document.addEventListener("touchmove",onDctTchMv,false);document.addEventListener("touchend",onDctTchEnd,false);document.getElementById("imgLeftArrowVers").onclick=null;document.getElementById("imgRightArrowVers").onclick=null;document.getElementById("buttonPlay").onclick=null;document.getElementById("buttonMute").onclick=null;document.getElementById("buttonAutorotate").onclick=null;document.getElementById("boutonModeNavigation").onclick=null;document.getElementById("boutonPlan2D").onclick=null;document.getElementById("bouton_Fullscreen").onclick=null;document.getElementById("boutonGyro").onclick=null;document.getElementById("imgLeftArrow").onclick=null;document.getElementById("imgRightArrow").onclick=null;document.getElementById("boutoncloseAnnot").onclick=null;document.getElementById("imgLeftArrowVig").onclick=null;document.getElementById("imgLeftArrowVig").onmouseup=null;document.getElementById("imgRightArrowVig").onclick=null;document.getElementById("imgRightArrowVig").onmouseup=null}else{document.getElementById("imgLeftArrowVers").ontouchend=null;document.getElementById("imgRightArrowVers").ontouchend=null;document.getElementById("buttonPlay").ontouchend=null;document.getElementById("buttonMute").ontouchend=null;document.getElementById("buttonAutorotate").ontouchend=null;document.getElementById("boutonModeNavigation").ontouchend=null;document.getElementById("boutonPlan2D").ontouchend=null;document.getElementById("bouton_Fullscreen").ontouchend=null;document.getElementById("boutonGyro").ontouchend=null;document.getElementById("imgLeftArrow").ontouchend=null;document.getElementById("imgRightArrow").ontouchend=null;document.getElementById("boutoncloseAnnot").ontouchend=null;document.getElementById("imgLeftArrowVig").ontouchend=null;document.getElementById("imgRightArrowVig").ontouchend=null}if(a.indexOf("DeviceMotionEventConstructor")>-1&&a.indexOf("DeviceOrientationEventConstructor")>-1){window.addEventListener("deviceorientation",onDvcOrtn,false);window.addEventListener("devicemotion",onDvcMtn,false)}}function initCmr(){if(isMadeByIVisit360==true){camera.fov=fov=orgFov;onMseDnMseX=0;onMseDnMseY=0;lon=90;lat=0;if(version5==true){lon=aglFtHCrt;lat=aglFtVCrt;var c=(aglHCrt-180)<=0?(180-aglHCrt):(540-aglHCrt);var a=new THREE.Matrix4();var d=new THREE.Matrix4();var b=new THREE.Matrix4();var f=-aglVCrt*Math.PI/180;var e=-(90-c)*Math.PI/180;d.makeRotationX(f);b.makeRotationY(e);a.multiply(b,d);mesh.rotation.setEulerFromRotationMatrix(a)}onMseDnLn=0;onMseDnLt=0;phi=0;theta=0;oldtheta=0;theta2=0}else{camera.fov=fov=orgFov;onMseDnMseX=0;onMseDnMseY=0;lon=90;lat=0;if(version5==true){lon=(anFtHCrt-180)<=0?(180-anFtHCrt):(540-anFtHCrt);lat=(90-anFtVCrt);var a=new THREE.Matrix4();var d=new THREE.Matrix4();var b=new THREE.Matrix4();var f=-(90-anVCrt)*Math.PI/180;var e=-(90-anHCrt)*Math.PI/180;d.makeRotationX(f);b.makeRotationY(e);a.multiply(b,d);mesh.rotation.setEulerFromRotationMatrix(a)}onMseDnLn=0;onMseDnLt=0;phi=0;theta=0;oldtheta=0;theta2=0}}function initCmr2(){if(isMadeByIVisit360==true){if(vrsChg==false){camera.fov=fov=orgFov}else{camera.fov=fov}onMseDnMseX=0;onMseDnMseY=0;if(version5==true){var c=(aglHCrt-180)<=0?(180-aglHCrt):(540-aglHCrt);var a=new THREE.Matrix4();var d=new THREE.Matrix4();var b=new THREE.Matrix4();var f=-aglVCrt*Math.PI/180;var e=-(90-c)*Math.PI/180;d.makeRotationX(f);b.makeRotationY(e);a.multiply(b,d);mesh.rotation.setEulerFromRotationMatrix(a)}onMseDnLn=0;onMseDnLt=0;phi=0;theta=0;oldtheta=0;theta2=0}else{camera.fov=fov=orgFov;onMseDnMseX=0;onMseDnMseY=0;if(version5==true){var a=new THREE.Matrix4();var d=new THREE.Matrix4();var b=new THREE.Matrix4();var f=-(90-anVCrt)*Math.PI/180;var e=-(90-anHCrt)*Math.PI/180;d.makeRotationX(f);b.makeRotationY(e);a.multiply(b,d);mesh.rotation.setEulerFromRotationMatrix(a)}onMseDnLn=0;onMseDnLt=0;oldtheta=0;theta2=0}}function chgNvgMd(){if(isMadeByIVisit360==true){ccrAllAnt()}if(nvgMd==1){document.getElementById("boutonModeNavigation").src="./webglPlayer/navigationVignette2.png";nvgMd=2}else{if(nvgMd==2){document.getElementById("boutonModeNavigation").src="./webglPlayer/navigationVignette1.png";nvgMd=1}}}function toScreenXY(a,d,b){var e=a.clone();var c=new THREE.Matrix4();c.multiply(d.projectionMatrix,d.matrixWorldInverse);c.multiplyVector3(e);return{x:(e.x+1)*b.width/2+b.offsetLeft,y:(-e.y+1)*b.height/2+b.offsetTop}}function ldTxtr(d){var b=new THREE.Texture(txt_plchld);var a=new THREE.MeshBasicMaterial({map:b,overdraw:true});var c=new Image();c.onload=function(){b.needsUpdate=true;a.map.image=this;render()};c.src=d;b.deallocate();rdr3D.deallocateTexture(b);return a}var inFullScreen=false;function cclFSn(a){inFullScreen=false;var c=a.cancelFullScreen||a.webkitCancelFullScreen||a.mozCancelFullScreen||a.exitFullscreen||a.msExitFullscreen;if(c){c.call(a)}else{if(a.msExitFullscreen()){a.msExitFullscreen()}else{if(typeof window.ActiveXObject!=="undefined"){var b=new ActiveXObject("WScript.Shell");if(b!==null){b.SendKeys("{F11}")}}}}inFullScreen=false}function rqtFSn(a){inFullScreen=true;var c=a.requestFullScreen||a.webkitRequestFullScreen||a.mozRequestFullScreen||a.msRequestFullScreen;if(c){c.call(a)}else{if(typeof window.ActiveXObject!=="undefined"){var b=new ActiveXObject("WScript.Shell");b.SendKeys("{F11}");if(b!==null){b.SendKeys("{F11}")}}else{if(a.requestFullscreen){a.requestFullscreen()}else{if(a.msRequestFullscreen){a.msRequestFullscreen()}else{if(a.mozRequestFullScreen){a.mozRequestFullScreen()}else{if(a.webkitRequestFullscreen){a.webkitRequestFullscreen()}}}}}}inFullScreen=true}function tglF(){var b=document.body;var a=(document.fullScreenElement&&document.fullScreenElement!==null)||(document.mozFullScreen||document.webkitIsFullScreen);if(a||inFullScreen==true){cclFSn(document);document.getElementById("bouton_Fullscreen").src="./webglPlayer/pleinEcranOn.png";document.getElementById("bouton_Fullscreen").title="Enter fullscreen"}else{if(a==false||inFullScreen==false){rqtFSn(b);document.getElementById("bouton_Fullscreen").src="./webglPlayer/pleinEcranOff.png";document.getElementById("bouton_Fullscreen").title="Exit fullscreen"}}return false}function onWindowResize(){if(isMadeByIVisit360==true){if(document.getElementById("figureAnnot").style.visibility=="visible"){rszCpt()}else{if(document.getElementById("fenetreAnnot").style.visibility=="visible"){document.getElementById("closeAnnot").style.top=(window.innerHeight/2-document.getElementById("fenetreAnnot").offsetHeight/2-22)+"px";document.getElementById("closeAnnot").style.left=(window.innerWidth/2+document.getElementById("fenetreAnnot").offsetWidth/2-24)+"px"}}var d=document.getElementById("vignettes");d.style.width=(document.getElementById("conteneurVignettes").offsetWidth-44)+"px";var f=document.getElementById("vignettes").offsetHeight;document.getElementById("conteneurVignettes").style.top=(window.innerHeight-f)+"px";if(vgntVsb==true){document.getElementById("nomVignette").style.bottom=f+"px";document.getElementById("controlButtons").style.bottom=(f+10)+"px"}else{document.getElementById("controlButtons").style.bottom="10px"}if(planVisible==true){rszPln(indPlCrt)}document.getElementById("controlButtons").style.left=(window.innerWidth/2-144)+"px";camera.aspect=window.innerWidth/window.innerHeight;camera.updateProjectionMatrix();rdr2D.setSize(window.innerWidth,window.innerHeight);rdr3D.setSize(window.innerWidth,window.innerHeight);camera.projectionMatrix.makePerspective(fov,window.innerWidth/window.innerHeight,1,300);ctx2d.font=icnFtT+" "+icnFtS+"px "+icnFtF}else{var d=document.getElementById("vignettes");d.style.width=(document.getElementById("conteneurVignettes").offsetWidth-44)+"px";if(planVisible==false&&vgntVsb==true){var f=document.getElementById("vignettes").offsetHeight;document.getElementById("nomVignette").style.bottom=f+"px";document.getElementById("conteneurVignettes").style.top=(window.innerHeight-f)+"px"}else{var b=document.getElementById("vignettesPlan").offsetHeight;var a=document.getElementById("fenetrePlan").offsetHeight;var c=document.getElementById("fenetrePlan").offsetWidth;var e=a-b-50;document.getElementById("lePlan").style.height=e+"px";document.getElementById("nomVignettePlan").style.top=(e+10)+"px";document.getElementById("nomVignettePlan").style.left=(38*3)+"px";document.getElementById("lePlan").style.width=(c-(38*6))+"px";document.getElementById("lePlan").style.left=(38*3)+"px";document.getElementById("leftArrow").style.marginTop=(e/2-38/2)+"px";document.getElementById("leftArrow").style.marginLeft=(38*2)+"px";document.getElementById("rightArrow").style.marginTop=(e/2-38/2)+"px";document.getElementById("rightArrow").style.marginRight=(38*2-10)+"px"}if(planVisible==true){rszPln(indPlCrt)}if(vgntVsb==true){document.getElementById("controlButtons").style.bottom=(f+10)+"px"}else{document.getElementById("controlButtons").style.bottom="10px"}document.getElementById("controlButtons").style.left=(window.innerWidth/2-82)+"px";camera.aspect=window.innerWidth/window.innerHeight;camera.updateProjectionMatrix();rdr2D.setSize(window.innerWidth,window.innerHeight);rdr3D.setSize(window.innerWidth,window.innerHeight);camera.projectionMatrix.makePerspective(fov,window.innerWidth/window.innerHeight,1,300);ctx2d.font="18px 'Times New Roman', Times, serif"}}function onDvcOrtn(a){if(isUsingMotion==true){deviceAlpha=Math.round(a.alpha);deviceBeta=Math.round(a.beta);deviceGamma=Math.round(a.gamma)}}function onDvcMtn(a){if(isUsingMotion==true){deviceGX=Math.round(a.accelerationIncludingGravity.x);deviceGY=Math.round(a.accelerationIncludingGravity.y);deviceGZ=Math.round(a.accelerationIncludingGravity.z)}}var degtorad=Math.PI/180;function getBaseRotationMatrix(b,r,h){var n=r?r*degtorad:0;var m=h?h*degtorad:0;var l=b?b*degtorad:0;var q=Math.cos(n);var p=Math.cos(m);var o=Math.cos(l);var f=Math.sin(n);var d=Math.sin(m);var c=Math.sin(l);var u=o*p-c*f*d;var t=-q*c;var s=p*c*f+o*d;var g=p*c+o*f*d;var e=o*q;var a=c*d-o*p*f;var k=-q*d;var j=f;var i=q*p;return[u,t,s,g,e,a,k,j,i]}function getScreenTransformationMatrix(c){var d=c?c*degtorad:0;var a=Math.cos(d);var e=Math.sin(d);var b=[a,-e,0,e,a,0,0,0,1];return b}function getWorldTransformationMatrix(){var b=90*degtorad;var a=Math.cos(b);var d=Math.sin(b);var c=[1,0,0,0,a,-d,0,d,a];return c}function matrixMultiply(e,d){var c=[];c[0]=e[0]*d[0]+e[1]*d[3]+e[2]*d[6];c[1]=e[0]*d[1]+e[1]*d[4]+e[2]*d[7];c[2]=e[0]*d[2]+e[1]*d[5]+e[2]*d[8];c[3]=e[3]*d[0]+e[4]*d[3]+e[5]*d[6];c[4]=e[3]*d[1]+e[4]*d[4]+e[5]*d[7];c[5]=e[3]*d[2]+e[4]*d[5]+e[5]*d[8];c[6]=e[6]*d[0]+e[7]*d[3]+e[8]*d[6];c[7]=e[6]*d[1]+e[7]*d[4]+e[8]*d[7];c[8]=e[6]*d[2]+e[7]*d[5]+e[8]*d[8];return c}function computeMatrix(){var b=getBaseRotationMatrix(deviceOrientationData.alpha,deviceOrientationData.beta,deviceOrientationData.gamma);var c=getScreenTransformationMatrix(currentScreenOrientation);var d=matrixMultiply(b,c);var e=getWorldTransformationMatrix();var a=matrixMultiply(d,e);return a}function onDctMseDn(b){if(isMadeByIVisit360==true){if(planVisible==false&&isCptVsb==false){var a=document.getElementById("vignettes").offsetHeight;if((vgntVsb==false)){b.preventDefault();isUsrIntrtg=true;mousex=(b.clientX/window.innerWidth)*2-1;mousey=-(b.clientY/window.innerHeight)*2+1;onPointerDownPointerX=b.clientX;onPointerDownPointerY=b.clientY;onPointerDownLon=lon;onPointerDownLat=lat}}}else{if(planVisible==false){var a=document.getElementById("vignettes").offsetHeight;if(b.clientY<(window.innerHeight-a)){b.preventDefault();isUsrIntrtg=true;mousex=(b.clientX/window.innerWidth)*2-1;mousey=-(b.clientY/window.innerHeight)*2+1;onPointerDownPointerX=b.clientX;onPointerDownPointerY=b.clientY;onPointerDownLon=lon;onPointerDownLat=lat}}}}function onDctTchStart(c){if(isMadeByIVisit360==true){if(c.targetTouches.length>=0){if(c.targetTouches.length==1){var e=c.targetTouches[0];if(planVisible==false&&isCptVsb==false){var a=document.getElementById("vignettes").offsetHeight;if((vgntVsb==false)){c.preventDefault();isUsrIntrtg=true;mousex=(e.pageX/window.innerWidth)*2-1;mousey=-(e.pageY/window.innerHeight)*2+1;onPointerDownPointerX=e.pageX;onPointerDownPointerY=e.pageY;onPointerDownLon=lon;onPointerDownLat=lat}var a=document.getElementById("conteneurVignettes").offsetHeight;if(e.pageY>(window.innerHeight-30)){document.getElementById("conteneurVignettes").style.visibility="visible";document.getElementById("vignettes").style.visibility="visible";mvThbs(1);vgntVsb=true}else{if(e.pageY<(window.innerHeight-a)){document.getElementById("conteneurVignettes").style.visibility="hidden";document.getElementById("vignettes").style.visibility="hidden";mvThbs(-1)}}}}else{if(c.targetTouches.length==2){var d=c.targetTouches[0];var b=c.targetTouches[1];oldTouchDist=Math.sqrt((d.pageX-b.pageX)*(d.pageX-b.pageX)+(d.pageY-b.pageY)*(d.pageY-b.pageY))}}}}else{if(c.targetTouches.length>=0){if(c.targetTouches.length==1){var e=c.targetTouches[0];if(planVisible==false){var a=document.getElementById("vignettes").offsetHeight;if(e.pageY<(window.innerHeight-a)){c.preventDefault();isUsrIntrtg=true;mousex=(e.pageX/window.innerWidth)*2-1;mousey=-(e.pageY/window.innerHeight)*2+1;onPointerDownPointerX=e.pageX;onPointerDownPointerY=e.pageY;onPointerDownLon=lon;onPointerDownLat=lat}var a=document.getElementById("conteneurVignettes").offsetHeight;if(e.pageY>(window.innerHeight-30)){document.getElementById("conteneurVignettes").style.visibility="visible";document.getElementById("vignettes").style.visibility="visible";mvThbs(1);vgntVsb=true}else{if(e.pageY<(window.innerHeight-a)){document.getElementById("conteneurVignettes").style.visibility="hidden";document.getElementById("vignettes").style.visibility="hidden";mvThbs(-1)}}}}else{if(c.targetTouches.length==2){var d=c.targetTouches[0];var b=c.targetTouches[1];oldTouchDist=Math.sqrt((d.pageX-b.pageX)*(d.pageX-b.pageX)+(d.pageY-b.pageY)*(d.pageY-b.pageY))}}}}}var intervalMvThumbs=null;var newPos=0;var timeMoveTh;var timeLaunch=false;var timeLaunchToBottom=false;function mvThbs(c){var b=document.getElementById("conteneurVignettes");var a=document.getElementById("vignettes").offsetHeight;b.style.top=(window.innerHeight-a)+"px";if(c==1){document.getElementById("nomVignette").style.bottom=a+"px";document.getElementById("controlButtons").style.bottom=(a+10)+"px"}else{if(c==-1){document.getElementById("nomVignette").style.bottom="0px";document.getElementById("controlButtons").style.bottom="10px"}}}function onDctMseMv(a){if(isMadeByIVisit360==true){document.getElementById("cnv2D").style.cursor="move";var c=document.getElementById("fenetreAnnot");if(planVisible==false&&isCptVsb==false){document.getElementById("labelVignette").style.visibility="hidden";if(isUsrIntrtg){if(Math.abs(onPointerDownPointerX-a.clientX)>5||Math.abs(onPointerDownPointerY-a.clientY)>5){isUsrMvg=true}document.getElementById("cnv2D").style.cursor="move";lon=-(onPointerDownPointerX-a.clientX)*0.1+onPointerDownLon;lat=-(a.clientY-onPointerDownPointerY)*0.3+onPointerDownLat;render()}if(isUsrIntrtg==false&&c.style.visibility=="hidden"&&isCptVsb==false){var f=document.getElementById("conteneurVignettes").offsetHeight;if((a.clientY>(window.innerHeight-20)&&(a.clientX<(window.innerWidth/2-144)||a.clientX>(window.innerWidth/2+144)))||(a.clientY>(window.innerHeight-10)&&(a.clientX>(window.innerWidth/2-144)||a.clientX<(window.innerWidth/2+144)))){document.getElementById("conteneurVignettes").style.visibility="visible";document.getElementById("vignettes").style.visibility="visible";mvThbs(1);vgntVsb=true}else{if((vgntVsb==true&&a.clientY<(window.innerHeight-f-55))||vgntVsb==false){document.getElementById("conteneurVignettes").style.visibility="hidden";document.getElementById("vignettes").style.visibility="hidden";mvThbs(-1);vgntVsb=false;document.getElementById("nomVignette").firstChild.nodeValue=nmIdCrt;mousex=(a.clientX/window.innerWidth)*2-1;mousey=-(a.clientY/window.innerHeight)*2+1;var d=new THREE.Vector3(mousex,mousey,0.5);projector.unprojectVector(d,camera);var l=new THREE.Ray(camera.position,d.subSelf(camera.position).normalize());var k=l.intersectObjects(scene.children);if(k.length>0&&tbTR.length>0){for(var g=0;g<tbTR.length;g++){if(tbTR[g][0]==idCrt){if(k[0].object.name==tbTR[g][1]){document.getElementById("cnv2D").style.cursor="pointer";document.getElementById("labelVignette").style.top=a.clientY+"px";document.getElementById("labelVignette").style.left=a.clientX+"px";document.getElementById("labelVignette").firstChild.nodeValue=tbTR[g][1];document.getElementById("labelVignette").style.visibility="visible";document.getElementById("nomVignette").firstChild.nodeValue=tbTR[g][1]}}}}if(k.length>0&&tbAnt.length>0){var e=k[0].object.name;for(var g=0;g<tbAnt.length;g++){if(tbAnt[g][0]==idCrt){var b=(e.indexOf("annotationImageVideo")==0||e.indexOf("emptyannotationImageVideo")==0)&&(tbAnt[g][1]=="onlineWebsite"||tbAnt[g][1]=="customAnnot"||tbAnt[g][1]=="captionAnnot")&&(e==tbAnt[g][2]||e=="empty"+tbAnt[g][2]);if(e){if(e.indexOf("annotLink_")==0||b==true){document.getElementById("cnv2D").style.cursor="pointer";document.getElementById("labelVignette").style.visibility="hidden";if(e.indexOf("emptyannotationImageVideo")==0){k[0].object.material.opacity=0.25}}}}}}for(var h=0;h<tbImgVidHTML.length;h++){if((tbImgVidHTML[h][0]).name.indexOf("emptyannotationImageVideo")==0&&(tbImgVidHTML[h][0]).name!=e){tbImgVidHTML[h][0].material.opacity=0}}}}}}}else{document.getElementById("cnv2D").style.cursor="auto";if(planVisible==false){document.getElementById("labelVignette").style.visibility="hidden";if(isUsrIntrtg){document.getElementById("cnv2D").style.cursor="move";if(Math.abs(onPointerDownPointerX-a.clientX)>5||Math.abs(onPointerDownPointerY-a.clientY)>5){isUsrMvg=true}lon=-(onPointerDownPointerX-a.clientX)*0.1+onPointerDownLon;lat=-(a.clientY-onPointerDownPointerY)*0.3+onPointerDownLat;render()}if(isUsrIntrtg==false){var f=document.getElementById("vignettes").offsetHeight;if((a.clientY>(window.innerHeight-20)&&(a.clientX<(window.innerWidth/2-82)||a.clientX>(window.innerWidth/2+82)))||(a.clientY>(window.innerHeight-10)&&(a.clientX>(window.innerWidth/2-82)||a.clientX<(window.innerWidth/2+82)))){document.getElementById("conteneurVignettes").style.visibility="visible";document.getElementById("vignettes").style.visibility="visible";mvThbs(1);vgntVsb=true}else{if((vgntVsb==true&&a.clientY<(window.innerHeight-f-55))||vgntVsb==false){document.getElementById("conteneurVignettes").style.visibility="hidden";document.getElementById("vignettes").style.visibility="hidden";mvThbs(-1);vgntVsb=false;document.getElementById("nomVignette").firstChild.nodeValue=nmIdCrt;mousex=(a.clientX/window.innerWidth)*2-1;mousey=-(a.clientY/window.innerHeight)*2+1;var d=new THREE.Vector3(mousex,mousey,0.5);projector.unprojectVector(d,camera);var l=new THREE.Ray(camera.position,d.subSelf(camera.position).normalize());var k=l.intersectObjects(scene.children);if(k.length>0&&tbTR.length>0){for(var g=0;g<tbCP.length;g+=nbElmPrNd){if(k[0].object.position.x==tbCP[g+4]&&k[0].object.position.y==tbCP[g+5]&&k[0].object.position.z==tbCP[g+6]){document.getElementById("cnv2D").style.cursor="pointer";document.getElementById("labelVignette").style.top=a.clientY+"px";document.getElementById("labelVignette").style.left=a.clientX+"px";document.getElementById("labelVignette").firstChild.nodeValue=tbCP[g+7];document.getElementById("labelVignette").style.visibility="visible";document.getElementById("nomVignette").firstChild.nodeValue=tbCP[g+7];break}}}}}}}}}function onDctTchMv(a){if(isMadeByIVisit360==true){if(a.targetTouches.length>=0){if(a.targetTouches.length==1){var l=a.targetTouches[0];document.getElementById("cnv2D").style.cursor="move";var d=document.getElementById("fenetreAnnot");if(planVisible==false&&isCptVsb==false){document.getElementById("labelVignette").style.visibility="hidden";if(isUsrIntrtg){if(Math.abs(onPointerDownPointerX-l.pageX)>5||Math.abs(onPointerDownPointerY-l.pageY)>5){isUsrMvg=true}document.getElementById("cnv2D").style.cursor="move";lon=-(onPointerDownPointerX-l.pageX)*0.1+onPointerDownLon;lat=-(l.pageY-onPointerDownPointerY)*0.3+onPointerDownLat;render()}if(isUsrIntrtg==false&&d.style.visibility=="hidden"&&isCptVsb==false){var g=document.getElementById("conteneurVignettes").offsetHeight;if((l.pageY>(window.innerHeight-20)&&(l.pageX<(window.innerWidth/2-144)||l.pageX>(window.innerWidth/2+144)))||(l.pageY>(window.innerHeight-10)&&(l.pageX>(window.innerWidth/2-144)||l.pageX<(window.innerWidth/2+144)))){document.getElementById("conteneurVignettes").style.visibility="visible";document.getElementById("vignettes").style.visibility="visible";mvThbs(1);vgntVsb=true}else{if(l.pageY<(window.innerHeight-g-55)){document.getElementById("conteneurVignettes").style.visibility="hidden";document.getElementById("vignettes").style.visibility="hidden";mvThbs(-1);vgntVsb=false;document.getElementById("nomVignette").firstChild.nodeValue=nmIdCrt;mousex=(l.pageX/window.innerWidth)*2-1;mousey=-(l.pageY/window.innerHeight)*2+1;var f=new THREE.Vector3(mousex,mousey,0.5);projector.unprojectVector(f,camera);var p=new THREE.Ray(camera.position,f.subSelf(camera.position).normalize());var n=p.intersectObjects(scene.children);if(n.length>0&&tbTR.length>0){for(var h=0;h<tbTR.length;h++){if(tbTR[h][0]==idCrt){if(n[0].object.name==tbTR[h][1]){document.getElementById("cnv2D").style.cursor="pointer";document.getElementById("labelVignette").style.top=a.clientY+"px";document.getElementById("labelVignette").style.left=a.clientX+"px";document.getElementById("labelVignette").firstChild.nodeValue=tbTR[h][1];document.getElementById("labelVignette").style.visibility="visible";document.getElementById("nomVignette").firstChild.nodeValue=tbTR[h][1]}}}}if(n.length>0&&tbAnt.length>0){var e=n[0].object.name;for(var h=0;h<tbAnt.length;h++){if(tbAnt[h][0]==idCrt){var c=(e.indexOf("annotationImageVideo")==0||e.indexOf("emptyannotationImageVideo")==0)&&(tbAnt[h][1]=="onlineWebsite"||tbAnt[h][1]=="customAnnot"||tbAnt[h][1]=="captionAnnot")&&(e==tbAnt[h][2]||e=="empty"+tbAnt[h][2]);if(e){if(e.indexOf("annotLink_")==0||c==true){document.getElementById("cnv2D").style.cursor="pointer";document.getElementById("labelVignette").style.top=a.clientY+"px";document.getElementById("labelVignette").style.left=a.clientX+"px";document.getElementById("labelVignette").firstChild.nodeValue=tbAnt[h][2];document.getElementById("labelVignette").style.visibility="hidden";if(e.indexOf("emptyannotationImageVideo")==0){n[0].object.material.opacity=0.25}}}}}}for(var k=0;k<tbImgVidHTML.length;k++){if((tbImgVidHTML[k][0]).name.indexOf("emptyannotationImageVideo")==0&&(tbImgVidHTML[k][0]).name!=e){tbImgVidHTML[k][0].material.opacity=0}}}}}}}else{if(a.targetTouches.length==2){cond=planVisible==false&&isCptVsb==false;if(cond){var o=a.targetTouches[0];var m=a.targetTouches[1];var b=Math.sqrt((o.pageX-m.pageX)*(o.pageX-m.pageX)+(o.pageY-m.pageY)*(o.pageY-m.pageY));if(b<oldTouchDist){fov+=1}else{if(b>oldTouchDist){fov-=1}}oldTouchDist=b;if(fov>120){fov=120}if(fov<10){fov=10}camera.projectionMatrix.makePerspective(fov,window.innerWidth/window.innerHeight,1,300);render()}}}}}else{if(a.targetTouches.length>=0){if(a.targetTouches.length==1){var l=a.targetTouches[0];document.getElementById("cnv2D").style.cursor="auto";if(planVisible==false){document.getElementById("labelVignette").style.visibility="hidden";if(isUsrIntrtg){document.getElementById("cnv2D").style.cursor="move";if(Math.abs(onPointerDownPointerX-l.pageX)>5||Math.abs(onPointerDownPointerY-l.pageY)>5){isUsrMvg=true}lon=-(onPointerDownPointerX-l.pageX)*0.1+onPointerDownLon;lat=-(l.pageY-onPointerDownPointerY)*0.3+onPointerDownLat;render()}if(isUsrIntrtg==false){var g=document.getElementById("vignettes").offsetHeight;if((l.pageY>(window.innerHeight-20)&&(l.pageX<(window.innerWidth/2-82)||l.pageX>(window.innerWidth/2+82)))||(l.pageY>(window.innerHeight-10)&&(l.pageX>(window.innerWidth/2-82)||l.pageX<(window.innerWidth/2+82)))){document.getElementById("conteneurVignettes").style.visibility="visible";document.getElementById("vignettes").style.visibility="visible";mvThbs(1);vgntVsb=true}else{if(l.pageY<(window.innerHeight-g-55)){document.getElementById("conteneurVignettes").style.visibility="hidden";document.getElementById("vignettes").style.visibility="hidden";mvThbs(-1);vgntVsb=false;document.getElementById("nomVignette").firstChild.nodeValue=nmIdCrt;mousex=(l.pageX/window.innerWidth)*2-1;mousey=-(l.pageY/window.innerHeight)*2+1;var f=new THREE.Vector3(mousex,mousey,0.5);projector.unprojectVector(f,camera);var p=new THREE.Ray(camera.position,f.subSelf(camera.position).normalize());var n=p.intersectObjects(scene.children);if(n.length>0&&tbTR.length>0){for(var h=0;h<tbCP.length;h+=nbElmPrNd){if(n[0].object.position.x==tbCP[h+4]&&n[0].object.position.y==tbCP[h+5]&&n[0].object.position.z==tbCP[h+6]){document.getElementById("cnv2D").style.cursor="pointer";document.getElementById("labelVignette").style.top=a.clientY+"px";document.getElementById("labelVignette").style.left=a.clientX+"px";document.getElementById("labelVignette").firstChild.nodeValue=tbCP[h+7];document.getElementById("labelVignette").style.visibility="visible";document.getElementById("nomVignette").firstChild.nodeValue=tbCP[h+7];break}}}}}}}}else{if(a.targetTouches.length==2){cond=(planVisible==false);if(cond){var o=a.targetTouches[0];var m=a.targetTouches[1];var b=Math.sqrt((o.pageX-m.pageX)*(o.pageX-m.pageX)+(o.pageY-m.pageY)*(o.pageY-m.pageY));if(b<oldTouchDist){fov+=1}else{if(b>oldTouchDist){fov-=1}}oldTouchDist=b;if(fov>120){fov=120}if(fov<10){fov=10}camera.projectionMatrix.makePerspective(fov,window.innerWidth/window.innerHeight,1,300);render()}}}}}}function onDctMseUp(b){if(isMadeByIVisit360==true){if(planVisible==false&&isCptVsb==false){isUsrIntrtg=false;oldtheta=theta=theta2;lon=theta*180/Math.PI;var e=new THREE.Vector3(mousex,mousey,0.5);projector.unprojectVector(e,camera);var n=new THREE.Ray(camera.position,e.subSelf(camera.position).normalize());var m=n.intersectObjects(scene.children);if(isUsrMvg==false&&m.length>0&&tbTR.length>0){for(var l=0;l<tbCP.length;l++){if(m[0].object.name==tbCP[l][0]){document.getElementById(idCrt).style.border="2px solid black";efrPtsClq();efrPtsAnt();effAntImgVid();var a=idCrt;idCrt=tbCP[l][0];idCrtSmpl=tbCP[l][1];document.getElementById(idCrt).style.border="2px solid red";nmIdCrt=tbCP[l][0];aglHCrt=tbCP[l][2];aglVCrt=tbCP[l][3];if(tbCP[l][4]==false){aglFtHCrt=tbCP[l][6];aglFtVCrt=tbCP[l][7];fov=orgFov=tbCP[l][8]}else{aglFtHCrt=tbCP[l][13];aglFtVCrt=tbCP[l][14];fov=orgFov=tbCP[l][15]}document.getElementById("nomVignette").firstChild.nodeValue=nmIdCrt;document.getElementById("labelVignette").style.visibility="hidden";if(plExt==true&&ptsPlnCrs==true&&tbCP[l][4]==true){document.getElementById(nmPlnAffCrt).style.border="2px solid black";document.getElementById(nmPlnCrt).style.border="2px solid black";nmPlnAffCrt=nmPlnCrt=tbCP[l][5];document.getElementById("nomVignettePlan").firstChild.nodeValue=nmPlnCrt}for(var g=0;g<materials.length;g++){rdr3D.deallocateTexture(materials[g].map);rdr3D.deallocateTexture(materials[g]);materials[g].deallocate();materials[g].map.deallocate()}materials=[ldTxtr(dsrAsst+igRt+idCrtSmpl+".jpg"),ldTxtr(dsrAsst+igLt+idCrtSmpl+".jpg"),ldTxtr(dsrAsst+igUp+idCrtSmpl+".jpg"),ldTxtr(dsrAsst+igDn+idCrtSmpl+".jpg"),ldTxtr(dsrAsst+igFt+idCrtSmpl+".jpg"),ldTxtr(dsrAsst+igBk+idCrtSmpl+".jpg")];mtrlPno.materials=materials;if(nvgMd==1){initCmr()}else{if(nvgMd==2){initCmr2()}}camera.projectionMatrix.makePerspective(fov,window.innerWidth/window.innerHeight,1,300);crrPtsClq();crrPtsAnt();crrAntImgVid();crrAntImgVid2();fndPnVrs(idCrt);pseVid(playOff);mtVid(muteOff)}}}if(isUsrMvg==false&&m.length>0&&tbAnt.length>0){var f=m[0].object.name;for(var l=0;l<tbAnt.length;l++){var c=(f.indexOf("annotationImageVideo")==0||f.indexOf("emptyannotationImageVideo")==0)&&(tbAnt[l][1]=="onlineWebsite"||tbAnt[l][1]=="customAnnot")&&(f==tbAnt[l][2]||f=="empty"+tbAnt[l][2]);var d=(f.indexOf("annotationImageVideo")==0||f.indexOf("emptyannotationImageVideo")==0)&&tbAnt[l][1]=="captionAnnot"&&(f==tbAnt[l][2]||f=="empty"+tbAnt[l][2]);if(f=="annotLink_"+tbAnt[l][1]+"_"+tbAnt[l][2]||c==true){affAnt(l)}else{if((f=="annotLink_"+tbAnt[l][1]+"0_"+tbAnt[l][2])||(f=="annotLink_"+tbAnt[l][1]+"1_"+tbAnt[l][2])||d==true){affCptAnt(l)}}}}isUsrMvg=false}}else{if(planVisible==false){isUsrIntrtg=false;oldtheta=theta=theta2;lon=theta*180/Math.PI;var e=new THREE.Vector3(mousex,mousey,0.5);projector.unprojectVector(e,camera);var n=new THREE.Ray(camera.position,e.subSelf(camera.position).normalize());var m=n.intersectObjects(scene.children);if(isUsrMvg==false&&m.length>0&&tbTR.length>0){for(var h=0;h<tbCP.length;h+=nbElmPrNd){if(m[0].object.position.x==tbCP[h+4]&&m[0].object.position.y==tbCP[h+5]&&m[0].object.position.z==tbCP[h+6]){document.getElementById(idCrt).style.border="2px solid black";efrPtsClq();var a=idCrt;idCrt=tbCP[h];document.getElementById(idCrt).style.border="2px solid red";cdxCrt=tbCP[h+1];cdyCrt=tbCP[h+2];cdzCrt=tbCP[h+3];nmIdCrt=tbCP[h+7];anHCrt=tbCP[h+9];anVCrt=tbCP[h+10];anFtHCrt=tbCP[h+11];anFtVCrt=tbCP[h+12];document.getElementById("nomVignette").firstChild.nodeValue=nmIdCrt;document.getElementById("labelVignette").style.visibility="hidden";if(plExt==true&&ptsPlnCrs==true){document.getElementById(nmPlAfCrt).style.border="2px solid black";document.getElementById(nmPlCrt).style.border="2px solid black";if(tbCP[h+8]!="noplanforthisnode"){nmPlAfCrt=nmPlCrt=tbCP[h+8];document.getElementById("nomVignettePlan").firstChild.nodeValue=nmPlCrt.substring(0,nmPlCrt.indexOf(".",0))}}for(var g=0;g<materials.length;g++){rdr3D.deallocateTexture(materials[g].map);rdr3D.deallocateTexture(materials[g]);materials[g].deallocate();materials[g].map.deallocate()}materials=[ldTxtr(dsrAsst+igRt+idCrt+".jpg"),ldTxtr(dsrAsst+igLt+idCrt+".jpg"),ldTxtr(dsrAsst+igUp+idCrt+".jpg"),ldTxtr(dsrAsst+igDn+idCrt+".jpg"),ldTxtr(dsrAsst+igFt+idCrt+".jpg"),ldTxtr(dsrAsst+igBk+idCrt+".jpg")];mtrlPno.materials=materials;if(nvgMd==1){initCmr()}else{if(nvgMd==2){initCmr2()}}camera.projectionMatrix.makePerspective(fov,window.innerWidth/window.innerHeight,1,300);crrPtsClq()}}}isUsrMvg=false}}}function onDctTchEnd(b){if(isMadeByIVisit360==true){if(b.targetTouches.length>=0){var l=b.targetTouches[0];if(planVisible==false&&isCptVsb==false){isUsrIntrtg=false;oldtheta=theta=theta2;lon=theta*180/Math.PI;var f=new THREE.Vector3(mousex,mousey,0.5);projector.unprojectVector(f,camera);var o=new THREE.Ray(camera.position,f.subSelf(camera.position).normalize());var n=o.intersectObjects(scene.children);if(isUsrMvg==false&&n.length>0&&tbTR.length>0){for(var m=0;m<tbCP.length;m++){if(n[0].object.name==tbCP[m][0]){document.getElementById(idCrt).style.border="2px solid black";efrPtsClq();efrPtsAnt();effAntImgVid();var a=idCrt;idCrt=tbCP[m][0];idCrtSmpl=tbCP[m][1];document.getElementById(idCrt).style.border="2px solid red";nmIdCrt=tbCP[m][0];aglHCrt=tbCP[m][2];aglVCrt=tbCP[m][3];if(tbCP[m][4]==false){aglFtHCrt=tbCP[m][6];aglFtVCrt=tbCP[m][7];fov=orgFov=tbCP[m][8]}else{aglFtHCrt=tbCP[m][13];aglFtVCrt=tbCP[m][14];fov=orgFov=tbCP[m][15]}document.getElementById("nomVignette").firstChild.nodeValue=nmIdCrt;document.getElementById("labelVignette").style.visibility="hidden";if(plExt==true&&ptsPlnCrs==true&&tbCP[m][4]==true){document.getElementById(nmPlnAffCrt).style.border="2px solid black";document.getElementById(nmPlnCrt).style.border="2px solid black";nmPlnAffCrt=nmPlnCrt=tbCP[m][5];document.getElementById("nomVignettePlan").firstChild.nodeValue=nmPlnCrt}for(var g=0;g<materials.length;g++){rdr3D.deallocateTexture(materials[g].map);rdr3D.deallocateTexture(materials[g]);materials[g].deallocate();materials[g].map.deallocate()}materials=[ldTxtr(dsrAsst+igRt+idCrtSmpl+".jpg"),ldTxtr(dsrAsst+igLt+idCrtSmpl+".jpg"),ldTxtr(dsrAsst+igUp+idCrtSmpl+".jpg"),ldTxtr(dsrAsst+igDn+idCrtSmpl+".jpg"),ldTxtr(dsrAsst+igFt+idCrtSmpl+".jpg"),ldTxtr(dsrAsst+igBk+idCrtSmpl+".jpg")];mtrlPno.materials=materials;if(nvgMd==1){initCmr()}else{if(nvgMd==2){initCmr2()}}camera.projectionMatrix.makePerspective(fov,window.innerWidth/window.innerHeight,1,300);crrPtsClq();crrPtsAnt();crrAntImgVid();crrAntImgVid2();fndPnVrs(idCrt);pseVid(playOff);mtVid(muteOff)}}}if(isUsrMvg==false&&n.length>0&&tbAnt.length>0){var e=n[0].object.name;for(var m=0;m<tbAnt.length;m++){var c=(e.indexOf("annotationImageVideo")==0||e.indexOf("emptyannotationImageVideo")==0)&&(tbAnt[m][1]=="onlineWebsite"||tbAnt[m][1]=="customAnnot")&&(e==tbAnt[m][2]||e=="empty"+tbAnt[m][2]);var d=(e.indexOf("annotationImageVideo")==0||e.indexOf("emptyannotationImageVideo")==0)&&tbAnt[m][1]=="captionAnnot"&&(e==tbAnt[m][2]||e=="empty"+tbAnt[m][2]);if(e=="annotLink_"+tbAnt[m][1]+"_"+tbAnt[m][2]||c==true){affAnt(m)}else{if((e=="annotLink_"+tbAnt[m][1]+"0_"+tbAnt[m][2])||(e=="annotLink_"+tbAnt[m][1]+"1_"+tbAnt[m][2])||d==true){affCptAnt(m)}}}}isUsrMvg=false}}}else{if(b.targetTouches.length>=0){var l=b.targetTouches[0];if(planVisible==false){isUsrIntrtg=false;oldtheta=theta=theta2;lon=theta*180/Math.PI;var f=new THREE.Vector3(mousex,mousey,0.5);projector.unprojectVector(f,camera);var o=new THREE.Ray(camera.position,f.subSelf(camera.position).normalize());var n=o.intersectObjects(scene.children);if(isUsrMvg==false&&n.length>0&&tbTR.length>0){for(var h=0;h<tbCP.length;h+=nbElmPrNd){if(n[0].object.position.x==tbCP[h+4]&&n[0].object.position.y==tbCP[h+5]&&n[0].object.position.z==tbCP[h+6]){document.getElementById(idCrt).style.border="2px solid black";efrPtsClq();var a=idCrt;idCrt=tbCP[h];document.getElementById(idCrt).style.border="2px solid red";cdxCrt=tbCP[h+1];cdyCrt=tbCP[h+2];cdzCrt=tbCP[h+3];nmIdCrt=tbCP[h+7];anHCrt=tbCP[h+9];anVCrt=tbCP[h+10];anFtHCrt=tbCP[h+11];anFtVCrt=tbCP[h+12];document.getElementById("nomVignette").firstChild.nodeValue=nmIdCrt;document.getElementById("labelVignette").style.visibility="hidden";if(plExt==true&&ptsPlnCrs==true){document.getElementById(nmPlAfCrt).style.border="2px solid black";document.getElementById(nmPlCrt).style.border="2px solid black";if(tbCP[h+8]!="noplanforthisnode"){nmPlAfCrt=nmPlCrt=tbCP[h+8];document.getElementById("nomVignettePlan").firstChild.nodeValue=nmPlCrt.substring(0,nmPlCrt.indexOf(".",0))}}for(var g=0;g<materials.length;g++){rdr3D.deallocateTexture(materials[g].map);rdr3D.deallocateTexture(materials[g]);materials[g].deallocate();materials[g].map.deallocate()}materials=[ldTxtr(dsrAsst+igRt+idCrt+".jpg"),ldTxtr(dsrAsst+igLt+idCrt+".jpg"),ldTxtr(dsrAsst+igUp+idCrt+".jpg"),ldTxtr(dsrAsst+igDn+idCrt+".jpg"),ldTxtr(dsrAsst+igFt+idCrt+".jpg"),ldTxtr(dsrAsst+igBk+idCrt+".jpg")];mtrlPno.materials=materials;if(nvgMd==1){initCmr()}else{if(nvgMd==2){initCmr2()}}camera.projectionMatrix.makePerspective(fov,window.innerWidth/window.innerHeight,1,300);crrPtsClq()}}}isUsrMvg=false}}}}function onDblClk(){if(planVisible==false){var a=document.getElementById("vignettes").offsetHeight;if(event.clientY<(window.innerHeight-a)){ctx2d.clearRect(0,0,window.innerWidth,window.innerHeight);camera.fov=fov=orgFov;camera.updateProjectionMatrix();render()}}}function onDctMsWhl(c){var b=false;if(isMadeByIVisit360==true){b=planVisible==false&&isCptVsb==false}else{b=(planVisible==false)}if(b){var a=document.getElementById("vignettes").offsetHeight;if(c.clientY<(window.innerHeight-a)){ctx2d.clearRect(0,0,window.innerWidth,window.innerHeight);if(c.wheelDeltaY){fov-=c.wheelDeltaY*0.05}else{if(c.wheelDelta){fov-=c.wheelDelta*0.05}else{if(c.detail){fov+=c.detail*1}}}if(fov>120){fov=120}if(fov<10){fov=10}camera.projectionMatrix.makePerspective(fov,window.innerWidth/window.innerHeight,1,300);render()}}}function animate(){requestAnimationFrame(animate);render()}var video,videoImageContext,videoTexture;var video2,videoImageContext2,videoTexture2;function render(){if(isUsingMotion==false){if(isUsrIntrtg&&isUsrMvg){lat=Math.max(-85,Math.min(85,lat));phi=(90+lat)*Math.PI/180;theta=lon*Math.PI/180;if(theta!=oldtheta){var l=Math.abs(theta-oldtheta)/(theta-oldtheta);var m=Math.abs(theta-oldtheta)*l;theta2-=m*Math.PI/50;if(theta2>=oldtheta+2*Math.PI){theta2=oldtheta}}camera.target.x=500*Math.sin(phi)*Math.cos(theta2);camera.target.y=500*Math.cos(phi);camera.target.z=500*Math.sin(phi)*Math.sin(theta2);camera.lookAt(camera.target)}else{if(autoRot){lon=(lon==360)?0:lon+0.1}lat=Math.max(-85,Math.min(85,lat));phi=(90+lat)*Math.PI/180;theta=lon*Math.PI/180;oldtheta=theta2=theta;camera.target.x=500*Math.sin(phi)*Math.cos(theta);camera.target.y=500*Math.cos(phi);camera.target.z=500*Math.sin(phi)*Math.sin(theta);camera.lookAt(camera.target)}}else{if(isUsingMotion==true){if(Math.abs(deviceGX)>Math.abs(deviceGY)){camera.target.x=500*Math.sin((180-deviceGamma)*Math.PI/180)*Math.cos(-deviceAlpha*Math.PI/180);camera.target.y=500*Math.cos((180-deviceGamma)*Math.PI/180);camera.target.z=500*Math.sin((180-deviceGamma)*Math.PI/180)*Math.sin(-deviceAlpha*Math.PI/180);camera.lookAt(camera.target)}}}if(isMadeByIVisit360==true){var n=new THREE.Frustum;n.setFromMatrix(new THREE.Matrix4().multiply(camera.projectionMatrix,camera.matrixWorldInverse));ctx2d.clearRect(0,0,window.innerWidth,window.innerHeight);for(var e=0;e<scene.children.length;e++){if(n.contains(scene.children[e])){var g=toScreenXY(scene.children[e].position,camera,cnv3D);if(0<=g.x&&g.x<=window.innerWidth&&0<=g.y&&g.y<=window.innerHeight){var a=scene.children[e].name;if(a){if(!(a.indexOf("annotLink_")==0)){var k=ctx2d.measureText(a);var h=k.width;if(icnTtP==0){ctx2d.fillStyle="rgba(100,100,100,0.5)";ctx2d.fillRect(g.x+16,g.y-icnFtS/2,h,icnFtS);ctx2d.fillStyle="#ffffff";ctx2d.fillText(a,g.x+16,g.y+icnFtS/3)}else{if(icnTtP==1){ctx2d.fillStyle="rgba(100,100,100,0.5)";ctx2d.fillRect(g.x-16-h,g.y-icnFtS/2,h,icnFtS);ctx2d.fillStyle="#ffffff";ctx2d.fillText(a,g.x-16-h,g.y+icnFtS/3)}else{if(icnTtP==2){ctx2d.fillStyle="rgba(100,100,100,0.5)";ctx2d.fillRect(g.x-(16+h)/2,g.y-16-icnFtS,h,icnFtS);ctx2d.fillStyle="#ffffff";ctx2d.fillText(a,g.x-(16+h)/2,g.y-18)}else{if(icnTtP==3){ctx2d.fillStyle="rgba(100,100,100,0.5)";ctx2d.fillRect(g.x-(16+h)/2,g.y+16,h,icnFtS);ctx2d.fillStyle="#ffffff";ctx2d.fillText(a,g.x-(16+h)/2,g.y+14+icnFtS)}}}}var c=new Image();c.src=dsrAnt+"icon_lien.png";ctx2d.drawImage(c,g.x-16,g.y-16)}else{if(a.indexOf("annotLink_onlineWebsite")==0){var c=new Image();c.src=dsrAnt+"icon_website.png";ctx2d.drawImage(c,g.x-c.width/2,g.y-c.height/2)}else{if(a.indexOf("annotLink_customAnnot")==0){var c=new Image();c.src=dsrAnt+"icon_annotation.png";ctx2d.drawImage(c,g.x-c.width/2,g.y-c.height/2)}else{if(a.indexOf("annotLink_captionAnnot1")==0){var c=new Image();c.src=dsrAnt+"icon_image.png";ctx2d.drawImage(c,g.x-c.width/2,g.y-c.height/2)}else{if(a.indexOf("annotLink_captionAnnot0")==0){var c=new Image();c.src=dsrAnt+"icon_video.png";ctx2d.drawImage(c,g.x-c.width/2,g.y-c.height/2)}}}}}}}}}for(var f=0;f<tbImgVidHTML.length;f++){if(tbImgVidHTML[f][3]==0){if((tbImgVidHTML[f][4]).readyState==(tbImgVidHTML[f][4]).HAVE_ENOUGH_DATA){(tbImgVidHTML[f][5]).drawImage((tbImgVidHTML[f][4]),0,0,tbImgVidHTML[f][1],tbImgVidHTML[f][2]);if(tbImgVidHTML[f][6]){(tbImgVidHTML[f][6]).needsUpdate=true}var o=Math.acos((camera.target.x*(tbImgVidHTML[f][7]).x+camera.target.y*(tbImgVidHTML[f][7]).y+camera.target.z*(tbImgVidHTML[f][7]).z)/(Math.sqrt(camera.target.x*camera.target.x+camera.target.y*camera.target.y+camera.target.z*camera.target.z)*Math.sqrt((tbImgVidHTML[f][7]).x*(tbImgVidHTML[f][7]).x+(tbImgVidHTML[f][7]).y*(tbImgVidHTML[f][7]).y+(tbImgVidHTML[f][7]).z*(tbImgVidHTML[f][7]).z)));o=o*180/Math.PI;var d=o>=100?0:Math.pow(o/100-1,4);var b=parseFloat(d.toFixed(2));tbImgVidHTML[f][4].volume=b>0?b:0}}}}else{if(tbTR.length>0){ctx2d.clearRect(0,0,window.innerWidth,window.innerHeight);for(var e=0;e<scene.children.length;e++){var n=new THREE.Frustum;n.setFromMatrix(new THREE.Matrix4().multiply(camera.projectionMatrix,camera.matrixWorldInverse));if(n.contains(scene.children[e])){var g=toScreenXY(scene.children[e].position,camera,cnv3D);if(0<=g.x&&g.x<=window.innerWidth&&0<=g.y&&g.y<=window.innerHeight){var a=scene.children[e].name;if(a){var k=ctx2d.measureText(a);var h=k.width;ctx2d.fillStyle="rgba(100,100,100,0.5)";ctx2d.fillRect(g.x+6,g.y-8,h,18);ctx2d.fillStyle="#ffffff";ctx2d.fillText(a,g.x+6,g.y+6);var c=new Image();c.src="./webglPlayer/pointDuPlan.png";ctx2d.drawImage(c,g.x-20,g.y-16)}}}}}}rdr3D.render(scene,camera)}function initAntImgVidCrds(){var r,a;for(var l=0;l<tbIgVd.length;l++){for(var f=0;f<tbCP.length;f++){if(tbCP[f][0]==tbIgVd[l][0]){r=tbCP[f][2];a=tbCP[f][3];break}}for(var h=0;h<4;h++){var q=tbIgVd[l][3*h+6];var n=tbIgVd[l][3*h+7];var m=tbIgVd[l][3*h+8];var c=q*Math.cos(-r*Math.PI/180)+m*Math.sin(-r*Math.PI/180);var t=n;var p=-q*Math.sin(-r*Math.PI/180)+m*Math.cos(-r*Math.PI/180);var g=1,e=0,d=0,b=1,s=0,o=0;g=Math.cos(-r*Math.PI/180);e=0;d=-Math.sin(-r*Math.PI/180);vctrRtAnArAx(a*Math.PI/180,g,e,d,c,t,p);tbIgVd[l][3*h+6]=-coordz2;tbIgVd[l][3*h+7]=coordy2;tbIgVd[l][3*h+8]=coordx2;while(Math.abs(tbIgVd[l][3*h+6])>128||Math.abs(tbIgVd[l][3*h+7])>128||Math.abs(tbIgVd[l][3*h+8])>128){tbIgVd[l][3*h+6]=tbIgVd[l][3*h+6]/2;tbIgVd[l][3*h+7]=tbIgVd[l][3*h+7]/2;tbIgVd[l][3*h+8]=tbIgVd[l][3*h+8]/2}}}}function effAntImgVid(){for(var c=0;c<tbImgVidHTML.length;c++){for(var b=scene.children.length-1;b>=0;b--){if(scene.children[b].name==(tbImgVidHTML[c][0]).name){scene.remove(scene.children[b]);if(tbImgVidHTML[c][3]==0){tbImgVidHTML[c][4].pause();tbImgVidHTML[c][4].currentTime=0}}}}for(var a=0;a<materialsTextureImg.length;a++){rdr3D.deallocateTexture(materialsTextureImg[a].map);rdr3D.deallocateTexture(materialsTextureImg[a]);materialsTextureImg[a].deallocate();materialsTextureImg[a].map.deallocate()}tbImgVidHTML.splice(0,tbImgVidHTML.length);materialsTextureImg.splice(0,materialsTextureImg.length);materialsImg.splice(0,materialsImg.length)}function crrAntImgVid(){ind1ImgVid=0;ind2ImgVid=0;for(var a=0;a<tbIgVd.length;a++){if(tbIgVd[a][0]==idCrt){if(tbIgVd[a][4]==1){if(tbIgVd[a][5]==""){materialsTextureImg[ind1ImgVid]=ldTxtr("./webglPlayer/imageVide.jpg");materialsImg[ind1ImgVid]=new THREE.MeshBasicMaterial({color:16711680,opacity:0,side:THREE.DoubleSide,wireframe:false})}else{materialsTextureImg[ind1ImgVid]=ldTxtr(dsrAnt+tbIgVd[a][5]);materialsImg[ind1ImgVid]=new THREE.MeshBasicMaterial(materialsTextureImg[ind1ImgVid])}materialsImg[ind1ImgVid].transparent=true;materialsImg[ind1ImgVid].overdraw=true;materialsImg[ind1ImgVid].side=THREE.DoubleSide;materialsImg[ind1ImgVid].needsUpdate=true;var c;if(tbIgVd[a][5]==""){var c=new THREE.PlaneGeometry(5,5,1,1);for(var b=0;b<2;b++){c.vertices[b].x=tbIgVd[a][3*b+6];c.vertices[b].y=tbIgVd[a][3*b+7];c.vertices[b].z=tbIgVd[a][3*b+8]}for(var b=2;b<4;b++){c.vertices[b].x=tbIgVd[a][3*(5-b)+6];c.vertices[b].y=tbIgVd[a][3*(5-b)+7];c.vertices[b].z=tbIgVd[a][3*(5-b)+8]}}else{c=new THREE.Geometry();for(var b=0;b<4;b++){c.vertices.push(new THREE.Vector3(tbIgVd[a][3*b+6],tbIgVd[a][3*b+7],tbIgVd[a][3*b+8]))}c.faces.push(new THREE.Face3(0,1,2));c.faces.push(new THREE.Face3(0,2,3));c.faceVertexUvs[0][0]=[new THREE.UV(0,1),new THREE.UV(1,1),new THREE.UV(1,0)];c.faceVertexUvs[0][1]=[new THREE.UV(0,1),new THREE.UV(1,0),new THREE.UV(0,0)]}videoPlanMesh5=new THREE.Mesh(c,materialsImg[ind1ImgVid]);if(tbIgVd[a][5]==""){videoPlanMesh5.name="empty"+tbIgVd[a][1]}else{videoPlanMesh5.name=tbIgVd[a][1]}if(tbIgVd[a].length>18){if(tbIgVd[a][18]==1){videoPlanMesh5.geometry.verticesNeedUpdate=true;videoPlanMesh5.geometry.computeFaceNormals();videoPlanMesh5.geometry.computeCentroids()}}tbImgVidHTML[ind2ImgVid]=new Array(videoPlanMesh5,tbIgVd[a][2],tbIgVd[a][3],tbIgVd[a][4]);ind1ImgVid++;ind2ImgVid++;scene.add(videoPlanMesh5)}}}}function crrAntImgVid2(){var h=false;for(var c=0;c<tbIgVd.length;c++){if(tbIgVd[c][0]==idCrt){if(tbIgVd[c][4]==0){h=true;var l,a,e;var k,f,b;l=document.createElement("video");l.src=dsrAnt+tbIgVd[c][5];l.loop=true;l.width=tbIgVd[c][2];l.height=tbIgVd[c][3];l.autoplay=true;a=document.createElement("canvas");a.width=tbIgVd[c][2];a.height=tbIgVd[c][3];e=a.getContext("2d");e.fillStyle="rgb( 255,0,0 )";e.fillRect(0,0,tbIgVd[c][2],tbIgVd[c][3]);k=new THREE.Texture(a);k.minFilter=THREE.LinearFilter;k.magFilter=THREE.LinearFilter;k.needsUpdate=true;f=new THREE.MeshBasicMaterial({map:k,overdraw:true,side:THREE.DoubleSide});f.needsUpdate=true;b=new THREE.Geometry();for(var d=0;d<4;d++){b.vertices.push(new THREE.Vector3(tbIgVd[c][3*d+6],tbIgVd[c][3*d+7],tbIgVd[c][3*d+8]))}var g=new THREE.Vector3(tbIgVd[c][9]/2+tbIgVd[c][6]/2,tbIgVd[c][10]/2+tbIgVd[c][7]/2,tbIgVd[c][11]/2+tbIgVd[c][8]/2);b.faces.push(new THREE.Face3(0,1,2));b.faces.push(new THREE.Face3(0,2,3));b.faceVertexUvs[0][0]=[new THREE.UV(0,1),new THREE.UV(1,1),new THREE.UV(1,0)];b.faceVertexUvs[0][1]=[new THREE.UV(0,1),new THREE.UV(1,0),new THREE.UV(0,0)];videoPlanMesh5=new THREE.Mesh(b,f);videoPlanMesh5.name=tbIgVd[c][1];if(tbIgVd[c].length>18){if(tbIgVd[c][18]==1){videoPlanMesh5.geometry.verticesNeedUpdate=true;videoPlanMesh5.geometry.computeFaceNormals();videoPlanMesh5.geometry.computeCentroids()}}tbImgVidHTML[ind2ImgVid]=new Array(videoPlanMesh5,tbIgVd[c][2],tbIgVd[c][3],tbIgVd[c][4],l,e,k,g);ind2ImgVid++;scene.add(videoPlanMesh5)}}}if(h==false){document.getElementById("buttonPlay").onclick=null;document.getElementById("buttonMute").onclick=null;document.getElementById("buttonPlay").ontouchend=null;document.getElementById("buttonMute").ontouchend=null;if(playOff){document.getElementById("buttonPlay").src="./webglPlayer/playOn_disable.png";document.getElementById("buttonPlay").title="Play videos"}else{document.getElementById("buttonPlay").src="./webglPlayer/playOff_disable.png";document.getElementById("buttonPlay").title="Pause videos"}if(muteOff){document.getElementById("buttonMute").src="./webglPlayer/muteOn_disable.png";document.getElementById("buttonMute").title="Sound"}else{document.getElementById("buttonMute").src="./webglPlayer/muteOff_disable.png";document.getElementById("buttonMute").title="Mute"}}else{document.getElementById("buttonPlay").onclick=playPauseVid;document.getElementById("buttonMute").onclick=muteVid;document.getElementById("buttonPlay").ontouchend=playPauseVid;document.getElementById("buttonMute").ontouchend=muteVid;if(playOff){document.getElementById("buttonPlay").src="./webglPlayer/playOn.png";document.getElementById("buttonPlay").title="Play videos"}else{document.getElementById("buttonPlay").src="./webglPlayer/playOff.png";document.getElementById("buttonPlay").title="Pause videos"}if(muteOff){document.getElementById("buttonMute").src="./webglPlayer/muteOn.png";document.getElementById("buttonMute").title="Sound"}else{document.getElementById("buttonMute").src="./webglPlayer/muteOff.png";document.getElementById("buttonMute").title="Mute"}}document.getElementById("controlButtons").style.left=(window.innerWidth/2-144)+"px"};